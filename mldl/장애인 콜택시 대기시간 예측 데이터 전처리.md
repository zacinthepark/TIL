# 장애인콜택시 대기시간 예측

## 0.미션

* 1.데이터를 탐색하며 정보 획득
    * 데이터는 2015-01-01 ~ 2022-12-31 까지의 서울 장애인 콜택시 운행 정보입니다. 우리는 평균대기시간을 예측하고자 합니다.
    * 요일, 월, 계절, 연도별 운행 정보에 어떤 주기와 변화가 있는지 탐색해 봅시다.

* 2.분석을 위한 데이터 구조 만들기
    * 문제정의 : 전 날 콜택시 운행이 종료되었을 때, 다음 날 대기시간을 예측하고자 합니다.
    * 만약 다음 날 대기시간을 예측할 수 있다면, 일정 범위 내에서 배차를 조절할 수 있을 뿐만 아니라, 향후 교통약자의 이동 편의 증진을 위한 정책 수립 및 개선에 기여할 수 있습니다.
    * 이를 위한 데이터 구조를 만들어 봅시다.
        * 분석 단위는 일별 데이터입니다.
        * 주어진 데이터 : 장애인 콜택시 운행 정보, 서울시 날씨
        * 날씨 데이터는 실제 측정값이지만, 다음 날에 대한 예보 데이터로 간주합니다.
            * 예를 들어
            * 2020-12-23 의 날씨 데이터는 전 날(12월22일) 날씨예보 데이터로 간주하여 분석을 수행합니다.
            * 2020-12-22일의 장애인 이동 데이터로 23일의 대기시간을 예측해야 하며, 이때 고려할 날씨데이터는 23일 데이터입니다.
        * 장애인 이동 데이터를 기준으로 날씨 데이터를 붙여서 만듭시다.
        * 휴무일 데이터는 패키지를 통해서 다운받아 사용합니다.

* Feature Engineering
    * 대기시간에 영향을 주는 요인을 도출하고(가설수립) 이를 feature로 생성합시다.
    * 주어진 그대로의 데이터가 아닌 새로운 feature를 생성해 봅시다.
        * 날짜와 관련된 feature : 요일, 월, 계절 등
        * 시계열 특성이 반영된 feature : 최근 7일간의 평균 대기시간 등

## 1.환경설정

### (1) 경로 설정

#### 1) 로컬 수행(Anaconda)

```python
# path = 'C:/Users/User/project/'
```

#### 2) 구글 콜랩 수행

* 구글 드라이브 연결

```python
# colab 그래프 한글화 코드
# jupyter 사용시 코드 주석처리 할 것.
# import seaborn as sns
# import matplotlib.pyplot as plt
# import matplotlib as mpl
# import warnings

# !sudo apt-get install -y fonts-nanum
# !sudo fc-cache -fv
# !rm ~/.cache/matplotlib -rf

# warnings.simplefilter(action='ignore', category=UserWarning)

# plt.rc('font', family='NanumBarunGothic')
# mpl.rcParams['axes.unicode_minus'] = False

# # colab - drive 연동
# from google.colab import drive
# drive.mount('/content/drive')
```

```python
# from google.colab import drive
# drive.mount('/content/drive')
```

```python
# path = '/content/drive/MyDrive/project/'
```

### (2) 라이브러리 설치 및 불러오기

#### 1) 설치

* requirements.txt 파일을 아래 위치에 두고 다음 코드를 실행하시오.
    * 로컬 : 다음 코드셀 실행
    * 구글콜랩 : requirements.txt 파일을 왼쪽 `[파일]`탭에 복사해 넣고 다음 코드셀 실행

```python
# !pip install -r requirements.txt
```

#### 2) 라이브러리 로딩

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import koreanize_matplotlib
import seaborn as sns
import joblib
```

### (3) 데이터 불러오기

#### 1) 데이터로딩

![z_min_2_2_1_1](https://github.com/zacinthepark/TIL/assets/86648892/14887683-9dfa-48bf-94e9-1d23745dd891)

```python
data = pd.read_csv('open_data.csv')
weather = pd.read_csv('weather.csv')
```

```python
display(data.head(3))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>기준일</th>
      <th>차량운행</th>
      <th>접수건</th>
      <th>탑승건</th>
      <th>평균대기시간</th>
      <th>평균요금</th>
      <th>평균승차거리</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-01</td>
      <td>213</td>
      <td>1023</td>
      <td>924</td>
      <td>23.2</td>
      <td>2427</td>
      <td>10764</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-02</td>
      <td>420</td>
      <td>3158</td>
      <td>2839</td>
      <td>17.2</td>
      <td>2216</td>
      <td>8611</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-03</td>
      <td>209</td>
      <td>1648</td>
      <td>1514</td>
      <td>26.2</td>
      <td>2377</td>
      <td>10198</td>
    </tr>
  </tbody>
</table>
</div>

```python
display(weather.head(3))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>rain(mm)</th>
      <th>humidity_max(%)</th>
      <th>humidity_min(%)</th>
      <th>sunshine(MJ/m2)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2012-01-01</td>
      <td>0.4</td>
      <td>-6.6</td>
      <td>0.0</td>
      <td>77.0</td>
      <td>45.0</td>
      <td>4.90</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2012-01-02</td>
      <td>-1.2</td>
      <td>-8.3</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>48.0</td>
      <td>6.16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2012-01-03</td>
      <td>-0.4</td>
      <td>-6.6</td>
      <td>0.4</td>
      <td>86.0</td>
      <td>45.0</td>
      <td>4.46</td>
    </tr>
  </tbody>
</table>
</div>

#### 2) 기본 정보 조회

```python
# 전체 데이터의 행,열 개수 확인
display(data.shape)
display(weather.shape)
```

<pre>
(2922, 7)
</pre>
<pre>
(4018, 7)
</pre>

```python
# 전체 데이터의 모든 변수 확인
display(data.info())
print('=' * 50)
display(weather.info())
```

<pre>
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 2922 entries, 0 to 2921
Data columns (total 7 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   기준일     2922 non-null   object 
 1   차량운행    2922 non-null   int64  
 2   접수건     2922 non-null   int64  
 3   탑승건     2922 non-null   int64  
 4   평균대기시간  2922 non-null   float64
 5   평균요금    2922 non-null   int64  
 6   평균승차거리  2922 non-null   int64  
dtypes: float64(1), int64(5), object(1)
memory usage: 159.9+ KB
</pre>
<pre>
None
</pre>
<pre>
==================================================
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 4018 entries, 0 to 4017
Data columns (total 7 columns):
 #   Column           Non-Null Count  Dtype  
---  ------           --------------  -----  
 0   Date             4018 non-null   object 
 1   temp_max         4018 non-null   float64
 2   temp_min         4018 non-null   float64
 3   rain(mm)         4018 non-null   float64
 4   humidity_max(%)  4018 non-null   float64
 5   humidity_min(%)  4018 non-null   float64
 6   sunshine(MJ/m2)  4018 non-null   float64
dtypes: float64(6), object(1)
memory usage: 219.9+ KB
</pre>
<pre>
None
</pre>

#### 3) 칼럼이름을 영어로 변경

```python
data.rename(columns = {
    '기준일': 'Date',
    '차량운행': 'count_taxi',
    '접수건': 'receipt',
    '탑승건': 'boarding',
    '평균대기시간': 'avg_wait_time',
    '평균요금': 'avg_rate',
    '평균승차거리': 'avg_ride_distance'
}, inplace = True)
```

```python
display(data.head(3))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_wait_time</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-01</td>
      <td>213</td>
      <td>1023</td>
      <td>924</td>
      <td>23.2</td>
      <td>2427</td>
      <td>10764</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-02</td>
      <td>420</td>
      <td>3158</td>
      <td>2839</td>
      <td>17.2</td>
      <td>2216</td>
      <td>8611</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-03</td>
      <td>209</td>
      <td>1648</td>
      <td>1514</td>
      <td>26.2</td>
      <td>2377</td>
      <td>10198</td>
    </tr>
  </tbody>
</table>
</div>

## 2.데이터 기본 탐색

### (1) 주기별 분석을 위해서 날짜 변수 추가하기

* data를 복사합니다.
* 복사한 df에 요일, 주차, 월, 연도 등을 추가합니다.

```python
data['Date'] = pd.to_datetime(data['Date'])
weather['Date'] = pd.to_datetime(weather['Date'])
```

```python
copy_df = data.copy()

copy_df['day'] = copy_df['Date'].dt.day
copy_df['weekday'] = copy_df['Date'].dt.weekday
copy_df['month'] = copy_df['Date'].dt.month
copy_df['year'] = copy_df['Date'].dt.year
```

```python
display(copy_df.head(2))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_wait_time</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>day</th>
      <th>weekday</th>
      <th>month</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-01</td>
      <td>213</td>
      <td>1023</td>
      <td>924</td>
      <td>23.2</td>
      <td>2427</td>
      <td>10764</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>2015</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-02</td>
      <td>420</td>
      <td>3158</td>
      <td>2839</td>
      <td>17.2</td>
      <td>2216</td>
      <td>8611</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>2015</td>
    </tr>
  </tbody>
</table>
</div>

### (2) 일별

* 차량 운행수

```python
group_day = copy_df.groupby('day', as_index=False).mean()
display(group_day.head(2))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>day</th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_wait_time</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>weekday</th>
      <th>month</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2018-12-16 05:00:00</td>
      <td>388.375000</td>
      <td>3462.656250</td>
      <td>2875.177083</td>
      <td>37.095833</td>
      <td>2325.781250</td>
      <td>9481.916667</td>
      <td>3.000000</td>
      <td>6.5</td>
      <td>2018.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2018-12-17 05:00:00</td>
      <td>419.520833</td>
      <td>3925.177083</td>
      <td>3277.520833</td>
      <td>37.564583</td>
      <td>2290.927083</td>
      <td>9128.427083</td>
      <td>2.979167</td>
      <td>6.5</td>
      <td>2018.5</td>
    </tr>
  </tbody>
</table>
</div>

```python
group_day[['day', 'count_taxi']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>day</th>
      <th>count_taxi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>388.375000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>419.520833</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>408.614583</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>418.666667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>408.968750</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>409.031250</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>427.583333</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>428.739583</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>409.052083</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>416.083333</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>421.281250</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>415.989583</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>417.125000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>14</td>
      <td>425.156250</td>
    </tr>
    <tr>
      <th>14</th>
      <td>15</td>
      <td>412.333333</td>
    </tr>
    <tr>
      <th>15</th>
      <td>16</td>
      <td>420.958333</td>
    </tr>
    <tr>
      <th>16</th>
      <td>17</td>
      <td>422.052083</td>
    </tr>
    <tr>
      <th>17</th>
      <td>18</td>
      <td>422.697917</td>
    </tr>
    <tr>
      <th>18</th>
      <td>19</td>
      <td>421.708333</td>
    </tr>
    <tr>
      <th>19</th>
      <td>20</td>
      <td>418.677083</td>
    </tr>
    <tr>
      <th>20</th>
      <td>21</td>
      <td>426.281250</td>
    </tr>
    <tr>
      <th>21</th>
      <td>22</td>
      <td>428.312500</td>
    </tr>
    <tr>
      <th>22</th>
      <td>23</td>
      <td>440.260417</td>
    </tr>
    <tr>
      <th>23</th>
      <td>24</td>
      <td>416.031250</td>
    </tr>
    <tr>
      <th>24</th>
      <td>25</td>
      <td>405.729167</td>
    </tr>
    <tr>
      <th>25</th>
      <td>26</td>
      <td>420.239583</td>
    </tr>
    <tr>
      <th>26</th>
      <td>27</td>
      <td>419.541667</td>
    </tr>
    <tr>
      <th>27</th>
      <td>28</td>
      <td>423.416667</td>
    </tr>
    <tr>
      <th>28</th>
      <td>29</td>
      <td>430.522222</td>
    </tr>
    <tr>
      <th>29</th>
      <td>30</td>
      <td>424.147727</td>
    </tr>
    <tr>
      <th>30</th>
      <td>31</td>
      <td>410.392857</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_day, x='day', y='count_taxi')
plt.show()
```

![z_min_2_2_1_2](https://github.com/zacinthepark/TIL/assets/86648892/4f7a0786-4a59-432e-bce8-1b1bd5b6f4e4)

* 접수건, 탑승건

```python
group_day[['day', 'receipt', 'boarding']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>day</th>
      <th>receipt</th>
      <th>boarding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>3462.656250</td>
      <td>2875.177083</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>3925.177083</td>
      <td>3277.520833</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3725.281250</td>
      <td>3129.187500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3886.364583</td>
      <td>3269.989583</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>3755.000000</td>
      <td>3153.093750</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>3740.760417</td>
      <td>3148.364583</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>4030.062500</td>
      <td>3377.666667</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>4058.052083</td>
      <td>3399.833333</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>3770.041667</td>
      <td>3180.666667</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>3910.520833</td>
      <td>3277.781250</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>3974.625000</td>
      <td>3327.687500</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>3941.635417</td>
      <td>3312.750000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>3969.510417</td>
      <td>3311.656250</td>
    </tr>
    <tr>
      <th>13</th>
      <td>14</td>
      <td>4019.187500</td>
      <td>3365.427083</td>
    </tr>
    <tr>
      <th>14</th>
      <td>15</td>
      <td>3839.427083</td>
      <td>3217.416667</td>
    </tr>
    <tr>
      <th>15</th>
      <td>16</td>
      <td>3952.166667</td>
      <td>3322.031250</td>
    </tr>
    <tr>
      <th>16</th>
      <td>17</td>
      <td>3948.937500</td>
      <td>3321.041667</td>
    </tr>
    <tr>
      <th>17</th>
      <td>18</td>
      <td>3992.968750</td>
      <td>3345.718750</td>
    </tr>
    <tr>
      <th>18</th>
      <td>19</td>
      <td>3976.906250</td>
      <td>3326.895833</td>
    </tr>
    <tr>
      <th>19</th>
      <td>20</td>
      <td>4081.114583</td>
      <td>3377.968750</td>
    </tr>
    <tr>
      <th>20</th>
      <td>21</td>
      <td>4080.166667</td>
      <td>3408.000000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>22</td>
      <td>4064.052083</td>
      <td>3412.166667</td>
    </tr>
    <tr>
      <th>22</th>
      <td>23</td>
      <td>4081.354167</td>
      <td>3416.354167</td>
    </tr>
    <tr>
      <th>23</th>
      <td>24</td>
      <td>3891.437500</td>
      <td>3243.697917</td>
    </tr>
    <tr>
      <th>24</th>
      <td>25</td>
      <td>3792.614583</td>
      <td>3161.687500</td>
    </tr>
    <tr>
      <th>25</th>
      <td>26</td>
      <td>3986.062500</td>
      <td>3336.489583</td>
    </tr>
    <tr>
      <th>26</th>
      <td>27</td>
      <td>3989.750000</td>
      <td>3315.802083</td>
    </tr>
    <tr>
      <th>27</th>
      <td>28</td>
      <td>4029.010417</td>
      <td>3345.718750</td>
    </tr>
    <tr>
      <th>28</th>
      <td>29</td>
      <td>4029.000000</td>
      <td>3351.255556</td>
    </tr>
    <tr>
      <th>29</th>
      <td>30</td>
      <td>3932.238636</td>
      <td>3277.738636</td>
    </tr>
    <tr>
      <th>30</th>
      <td>31</td>
      <td>3821.321429</td>
      <td>3170.357143</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_day, x='day', y='receipt', label='receipt')
sns.lineplot(data=group_day, x='day', y='boarding', label='boarding')
plt.legend()
plt.show()
```

![z_min_2_2_1_3](https://github.com/zacinthepark/TIL/assets/86648892/b45cf76f-31bd-4b1a-9160-c63e1f52c99e)

* 대기시간

```python
group_day[['day', 'avg_wait_time']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>day</th>
      <th>avg_wait_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>37.095833</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>37.564583</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>36.615625</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>38.382292</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>38.445833</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>36.551042</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>40.040625</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>41.313542</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>38.325000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>40.586458</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>39.836458</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>40.212500</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>40.711458</td>
    </tr>
    <tr>
      <th>13</th>
      <td>14</td>
      <td>41.136458</td>
    </tr>
    <tr>
      <th>14</th>
      <td>15</td>
      <td>39.602083</td>
    </tr>
    <tr>
      <th>15</th>
      <td>16</td>
      <td>39.921875</td>
    </tr>
    <tr>
      <th>16</th>
      <td>17</td>
      <td>39.721875</td>
    </tr>
    <tr>
      <th>17</th>
      <td>18</td>
      <td>41.413542</td>
    </tr>
    <tr>
      <th>18</th>
      <td>19</td>
      <td>41.018750</td>
    </tr>
    <tr>
      <th>19</th>
      <td>20</td>
      <td>44.436458</td>
    </tr>
    <tr>
      <th>20</th>
      <td>21</td>
      <td>42.431250</td>
    </tr>
    <tr>
      <th>21</th>
      <td>22</td>
      <td>40.838542</td>
    </tr>
    <tr>
      <th>22</th>
      <td>23</td>
      <td>41.393750</td>
    </tr>
    <tr>
      <th>23</th>
      <td>24</td>
      <td>41.395833</td>
    </tr>
    <tr>
      <th>24</th>
      <td>25</td>
      <td>41.955208</td>
    </tr>
    <tr>
      <th>25</th>
      <td>26</td>
      <td>40.973958</td>
    </tr>
    <tr>
      <th>26</th>
      <td>27</td>
      <td>42.785417</td>
    </tr>
    <tr>
      <th>27</th>
      <td>28</td>
      <td>42.920833</td>
    </tr>
    <tr>
      <th>28</th>
      <td>29</td>
      <td>41.486667</td>
    </tr>
    <tr>
      <th>29</th>
      <td>30</td>
      <td>40.419318</td>
    </tr>
    <tr>
      <th>30</th>
      <td>31</td>
      <td>39.826786</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_day, x='day', y='avg_wait_time')
plt.show()
```

![z_min_2_2_1_4](https://github.com/zacinthepark/TIL/assets/86648892/397a89c9-2657-4eff-8a5f-a32b9653051e)

* 운임

```python
group_day[['day', 'avg_rate']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>day</th>
      <th>avg_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2325.781250</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2290.927083</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2312.458333</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>2302.812500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2309.729167</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>2307.687500</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>2294.854167</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>2299.104167</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>2306.854167</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>2304.322917</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>2301.156250</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>2304.364583</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>2303.218750</td>
    </tr>
    <tr>
      <th>13</th>
      <td>14</td>
      <td>2303.583333</td>
    </tr>
    <tr>
      <th>14</th>
      <td>15</td>
      <td>2309.604167</td>
    </tr>
    <tr>
      <th>15</th>
      <td>16</td>
      <td>2295.739583</td>
    </tr>
    <tr>
      <th>16</th>
      <td>17</td>
      <td>2298.947917</td>
    </tr>
    <tr>
      <th>17</th>
      <td>18</td>
      <td>2301.177083</td>
    </tr>
    <tr>
      <th>18</th>
      <td>19</td>
      <td>2303.312500</td>
    </tr>
    <tr>
      <th>19</th>
      <td>20</td>
      <td>2309.479167</td>
    </tr>
    <tr>
      <th>20</th>
      <td>21</td>
      <td>2299.479167</td>
    </tr>
    <tr>
      <th>21</th>
      <td>22</td>
      <td>2297.989583</td>
    </tr>
    <tr>
      <th>22</th>
      <td>23</td>
      <td>2293.593750</td>
    </tr>
    <tr>
      <th>23</th>
      <td>24</td>
      <td>2309.770833</td>
    </tr>
    <tr>
      <th>24</th>
      <td>25</td>
      <td>2316.416667</td>
    </tr>
    <tr>
      <th>25</th>
      <td>26</td>
      <td>2301.187500</td>
    </tr>
    <tr>
      <th>26</th>
      <td>27</td>
      <td>2308.218750</td>
    </tr>
    <tr>
      <th>27</th>
      <td>28</td>
      <td>2309.000000</td>
    </tr>
    <tr>
      <th>28</th>
      <td>29</td>
      <td>2302.088889</td>
    </tr>
    <tr>
      <th>29</th>
      <td>30</td>
      <td>2303.931818</td>
    </tr>
    <tr>
      <th>30</th>
      <td>31</td>
      <td>2306.357143</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_day, x='day', y='avg_rate')
plt.show()
```

![z_min_2_2_1_5](https://github.com/zacinthepark/TIL/assets/86648892/51a528a8-2b7b-405f-bb9d-5ea0481224ab)

* 이동거리

```python
group_day[['day', 'avg_ride_distance']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>day</th>
      <th>avg_ride_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>9481.916667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>9128.427083</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>9331.250000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>9242.875000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>9310.510417</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>9294.281250</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>9169.781250</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>9199.520833</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>9295.677083</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>9253.125000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>9215.364583</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>9242.437500</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>9233.635417</td>
    </tr>
    <tr>
      <th>13</th>
      <td>14</td>
      <td>9246.458333</td>
    </tr>
    <tr>
      <th>14</th>
      <td>15</td>
      <td>9290.833333</td>
    </tr>
    <tr>
      <th>15</th>
      <td>16</td>
      <td>9170.187500</td>
    </tr>
    <tr>
      <th>16</th>
      <td>17</td>
      <td>9200.656250</td>
    </tr>
    <tr>
      <th>17</th>
      <td>18</td>
      <td>9220.250000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>19</td>
      <td>9244.833333</td>
    </tr>
    <tr>
      <th>19</th>
      <td>20</td>
      <td>9313.395833</td>
    </tr>
    <tr>
      <th>20</th>
      <td>21</td>
      <td>9202.822917</td>
    </tr>
    <tr>
      <th>21</th>
      <td>22</td>
      <td>9184.197917</td>
    </tr>
    <tr>
      <th>22</th>
      <td>23</td>
      <td>9149.520833</td>
    </tr>
    <tr>
      <th>23</th>
      <td>24</td>
      <td>9296.562500</td>
    </tr>
    <tr>
      <th>24</th>
      <td>25</td>
      <td>9387.770833</td>
    </tr>
    <tr>
      <th>25</th>
      <td>26</td>
      <td>9239.156250</td>
    </tr>
    <tr>
      <th>26</th>
      <td>27</td>
      <td>9283.250000</td>
    </tr>
    <tr>
      <th>27</th>
      <td>28</td>
      <td>9299.958333</td>
    </tr>
    <tr>
      <th>28</th>
      <td>29</td>
      <td>9211.133333</td>
    </tr>
    <tr>
      <th>29</th>
      <td>30</td>
      <td>9248.295455</td>
    </tr>
    <tr>
      <th>30</th>
      <td>31</td>
      <td>9277.214286</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_day, x='day', y='avg_ride_distance')
plt.show()
```

![z_min_2_2_1_6](https://github.com/zacinthepark/TIL/assets/86648892/cfda2734-a0f9-480a-a05a-3b328927e1a3)

### (3) 요일별

* 차량 운행수

```python
group_weekday = copy_df.groupby('weekday', as_index=False).mean()
display(group_weekday.head(2))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_wait_time</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>2018-12-31 00:00:00.000000000</td>
      <td>485.014388</td>
      <td>4715.040767</td>
      <td>3961.242206</td>
      <td>39.243165</td>
      <td>2240.059952</td>
      <td>8656.577938</td>
      <td>15.764988</td>
      <td>6.515588</td>
      <td>2018.498801</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2019-01-01 00:00:00.000000256</td>
      <td>495.076739</td>
      <td>4800.884892</td>
      <td>4026.791367</td>
      <td>40.826139</td>
      <td>2242.805755</td>
      <td>8672.112710</td>
      <td>15.745803</td>
      <td>6.520384</td>
      <td>2018.501199</td>
    </tr>
  </tbody>
</table>
</div>

```python
group_weekday[['weekday', 'count_taxi']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>count_taxi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>485.014388</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>495.076739</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>484.726619</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>494.078947</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>485.107656</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>262.177033</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>224.767386</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_weekday, x='weekday', y='count_taxi')
plt.show()
```

![z_min_2_2_1_7](https://github.com/zacinthepark/TIL/assets/86648892/a45ae244-3f5c-483d-9576-3a7f8b9ab380)

* 접수건, 탑승건

```python
group_weekday[['weekday', 'receipt', 'boarding']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>receipt</th>
      <th>boarding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>4715.040767</td>
      <td>3961.242206</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>4800.884892</td>
      <td>4026.791367</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>4739.333333</td>
      <td>3956.976019</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>4760.677033</td>
      <td>3978.200957</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>4692.066986</td>
      <td>3877.385167</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>2069.081340</td>
      <td>1693.839713</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>1702.781775</td>
      <td>1493.556355</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_weekday, x='weekday', y='receipt', label='receipt')
sns.lineplot(data=group_weekday, x='weekday', y='boarding', label='boarding')
plt.legend()
plt.show()
```

![z_min_2_2_1_8](https://github.com/zacinthepark/TIL/assets/86648892/9886344f-8b64-4749-a5b8-9893d6ab6fb7)

* 대기시간

```python
group_weekday[['weekday', 'avg_wait_time']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>avg_wait_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>39.243165</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>40.826139</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>41.676259</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>41.043780</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>40.956459</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>43.480144</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>34.902878</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_weekday, x='weekday', y='avg_wait_time')
plt.show()
```

![z_min_2_2_1_9](https://github.com/zacinthepark/TIL/assets/86648892/6597007d-898c-4e5a-b9b0-d0e642a6ac2e)

* 운임

```python
group_weekday[['weekday', 'avg_rate']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>avg_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>2240.059952</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2242.805755</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>2250.422062</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>2256.366029</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>2246.023923</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>2429.641148</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>2464.541966</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_weekday, x='weekday', y='avg_rate')
plt.show()
```

![z_min_2_2_1_10](https://github.com/zacinthepark/TIL/assets/86648892/9d75257b-0e24-4ae8-9641-b09ab87b62c4)

* 이동거리

```python
group_weekday[['weekday', 'avg_ride_distance']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>avg_ride_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>8656.577938</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>8672.112710</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>8752.038369</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>8786.901914</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>8733.665072</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>10431.468900</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>10741.275779</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_weekday, x='weekday', y='avg_ride_distance')
plt.show()
```

![z_min_2_2_1_11](https://github.com/zacinthepark/TIL/assets/86648892/16e9236c-4aa4-4630-8ecb-b9cb4bfb58b1)

### (4) 월별

* 차량 운행수

```python
group_month = copy_df.groupby('month', as_index=False).mean()
display(group_month.head(2))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_wait_time</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>day</th>
      <th>weekday</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2018-07-17 12:00:00.000000000</td>
      <td>379.286290</td>
      <td>3681.826613</td>
      <td>3092.262097</td>
      <td>33.393952</td>
      <td>2279.616935</td>
      <td>9048.161290</td>
      <td>16.000000</td>
      <td>3.024194</td>
      <td>2018.500000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2018-08-14 12:12:44.601769984</td>
      <td>373.486726</td>
      <td>3582.097345</td>
      <td>3032.075221</td>
      <td>34.419469</td>
      <td>2296.623894</td>
      <td>9221.039823</td>
      <td>14.628319</td>
      <td>2.995575</td>
      <td>2018.495575</td>
    </tr>
  </tbody>
</table>
</div>

```python
group_month[['month', 'count_taxi']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>count_taxi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>379.286290</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>373.486726</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>398.758065</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>416.187500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>413.556452</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>430.925000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>436.935484</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>434.500000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>446.412500</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>432.939516</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>450.483333</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>409.173387</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_month, x='month', y='count_taxi')
plt.show()
```

![z_min_2_2_1_12](https://github.com/zacinthepark/TIL/assets/86648892/854d134a-435b-43d0-9d68-8800c68323c5)

* 접수건, 탑승건

```python
group_month[['month', 'receipt', 'boarding']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>receipt</th>
      <th>boarding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>3681.826613</td>
      <td>3092.262097</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>3582.097345</td>
      <td>3032.075221</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3691.330645</td>
      <td>3168.822581</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3964.479167</td>
      <td>3358.558333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>3910.572581</td>
      <td>3278.435484</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>4001.304167</td>
      <td>3372.837500</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>4099.637097</td>
      <td>3437.862903</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>4014.963710</td>
      <td>3350.512097</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>3962.508333</td>
      <td>3287.950000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>4007.709677</td>
      <td>3316.850806</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>4243.991667</td>
      <td>3498.500000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>3931.556452</td>
      <td>3202.068548</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_month, x='month', y='receipt', label='receipt')
sns.lineplot(data=group_month, x='month', y='boarding', label='boarding')
plt.legend()
plt.show()
```

![z_min_2_2_1_13](https://github.com/zacinthepark/TIL/assets/86648892/d61912c9-690f-4ca4-a982-840bccf3b722)

* 대기시간

```python
group_month[['month', 'avg_wait_time']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>avg_wait_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>33.393952</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>34.419469</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>35.182258</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>39.628750</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>41.181452</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>40.381667</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>40.033468</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>38.568952</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>42.364167</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>44.480242</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>47.063333</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>46.713306</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_month, x='month', y='avg_wait_time')
plt.show()
```

![z_min_2_2_1_14](https://github.com/zacinthepark/TIL/assets/86648892/3bec2884-6e16-4606-8271-f945fd0dc4d3)

* 운임

```python
group_month[['month', 'avg_rate']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>avg_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2279.616935</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2296.623894</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2291.600806</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>2310.712500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2326.209677</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>2308.991667</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>2290.407258</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>2286.189516</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>2331.583333</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>2334.774194</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>2309.175000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>2286.104839</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_month, x='month', y='avg_rate')
plt.show()
```

![z_min_2_2_1_15](https://github.com/zacinthepark/TIL/assets/86648892/972609f2-98cb-4115-ae0c-e4d5e060d6dc)

* 이동거리

```python
group_month[['month', 'avg_ride_distance']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>avg_ride_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>9048.161290</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>9221.039823</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>9129.588710</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>9313.458333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>9462.447581</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>9292.650000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>9151.556452</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>9127.072581</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>9493.016667</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>9485.576613</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>9251.379167</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>9074.028226</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_month, x='month', y='avg_ride_distance')
plt.show()
```

![z_min_2_2_1_16](https://github.com/zacinthepark/TIL/assets/86648892/ad6e8bb1-1c51-42f6-9e1e-11ff74b97da1)

### (5) 연도별

* 차량 운행수

```python
group_year = copy_df.groupby('year', as_index = False).mean()
display(group_year.head(2))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_wait_time</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>day</th>
      <th>weekday</th>
      <th>month</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>2015-07-02 00:00:00</td>
      <td>381.468493</td>
      <td>3750.531507</td>
      <td>3268.673973</td>
      <td>34.059452</td>
      <td>2301.523288</td>
      <td>9558.975342</td>
      <td>15.720548</td>
      <td>3.000000</td>
      <td>6.526027</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016</td>
      <td>2016-07-01 12:00:00</td>
      <td>390.314208</td>
      <td>4005.087432</td>
      <td>3418.183060</td>
      <td>38.272404</td>
      <td>2316.404372</td>
      <td>9581.713115</td>
      <td>15.756831</td>
      <td>3.008197</td>
      <td>6.513661</td>
    </tr>
  </tbody>
</table>
</div>

```python
group_year[['year', 'count_taxi']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>count_taxi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>381.468493</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016</td>
      <td>390.314208</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>405.397260</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018</td>
      <td>397.758904</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019</td>
      <td>399.068493</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2020</td>
      <td>416.521858</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2021</td>
      <td>468.271233</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022</td>
      <td>490.898630</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_year, x='year', y='count_taxi')
plt.show()
```

![z_min_2_2_1_17](https://github.com/zacinthepark/TIL/assets/86648892/a83f641d-9663-46dc-b9e3-c4ebf25e7a8d)

* 접수건, 탑승건

```python
group_year[['year', 'receipt', 'boarding']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>receipt</th>
      <th>boarding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>3750.531507</td>
      <td>3268.673973</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016</td>
      <td>4005.087432</td>
      <td>3418.183060</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>4184.745205</td>
      <td>3471.709589</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018</td>
      <td>4077.473973</td>
      <td>3209.380822</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019</td>
      <td>4104.358904</td>
      <td>3230.279452</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2020</td>
      <td>3137.480874</td>
      <td>2656.314208</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2021</td>
      <td>3796.821918</td>
      <td>3344.109589</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022</td>
      <td>4350.304110</td>
      <td>3673.863014</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_year, x='year', y='receipt', label='receipt')
sns.lineplot(data=group_year, x='year', y='boarding', label='boarding')
plt.legend()
plt.show()
```

![z_min_2_2_1_18](https://github.com/zacinthepark/TIL/assets/86648892/27747e45-09ce-461f-bafc-8a2d458c8e87)

* 대기시간

```python
group_year[['year', 'avg_wait_time']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>avg_wait_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>34.059452</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016</td>
      <td>38.272404</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>44.143014</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018</td>
      <td>56.322192</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019</td>
      <td>53.455616</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2020</td>
      <td>28.045082</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2021</td>
      <td>30.720822</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022</td>
      <td>37.466027</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_year, x='year', y='avg_wait_time')
plt.show()
```

![z_min_2_2_1_19](https://github.com/zacinthepark/TIL/assets/86648892/c6aa2339-b14d-4d08-8839-a350a2bc881d)

* 운임

```python
group_year[['year', 'avg_rate']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>avg_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>2301.523288</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016</td>
      <td>2316.404372</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>2321.558904</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018</td>
      <td>2319.293151</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019</td>
      <td>2316.846575</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2020</td>
      <td>2308.505464</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2021</td>
      <td>2270.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022</td>
      <td>2280.002740</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_year, x='year', y='avg_rate')
plt.show()
```

![z_min_2_2_1_20](https://github.com/zacinthepark/TIL/assets/86648892/1cc75d77-8274-44a2-81c4-fae8b5615e56)

* 이동거리

```python
group_year[['year', 'avg_ride_distance']]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>avg_ride_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>9558.975342</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016</td>
      <td>9581.713115</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>9311.230137</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018</td>
      <td>9296.868493</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019</td>
      <td>9258.534247</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2020</td>
      <td>9181.213115</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2021</td>
      <td>8864.536986</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022</td>
      <td>8974.227397</td>
    </tr>
  </tbody>
</table>
</div>

```python
sns.lineplot(data=group_year, x='year', y='avg_ride_distance')
plt.show()
```

![z_min_2_2_1_21](https://github.com/zacinthepark/TIL/assets/86648892/80c1c100-6878-400c-ad4c-f4189a363c66)

## 3.데이터 구조 만들기

* 목표 : 전날 저녁, 다음날 평균 대기시간을 예측하고자 합니다.
* 날씨 데이터는 실제 측정값이지만, 다음 날에 대한 예보 데이터로 간주합니다.
* 예를 들어
* 2020-12-23 의 날씨 데이터는 전날(12월22일) 날씨예보 데이터로 간주하여 분석을 수행합니다.
* 2020-12-22일의 장애인 이동 데이터로 23일의 대기시간을 예측해야 하며, 이때 고려할 날씨데이터는 23일 데이터입니다.
* 장애인 이동 데이터를 기준으로 날씨 데이터를 붙입니다.

### (1) target 만들기

* 예측하는 날짜, 대기시간(target)으로 기준을 잡습니다.

```python
display(data.tail(3))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_wait_time</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2919</th>
      <td>2022-12-29</td>
      <td>581</td>
      <td>5250</td>
      <td>4247</td>
      <td>52.5</td>
      <td>2229</td>
      <td>8433</td>
    </tr>
    <tr>
      <th>2920</th>
      <td>2022-12-30</td>
      <td>600</td>
      <td>5293</td>
      <td>4200</td>
      <td>38.3</td>
      <td>2183</td>
      <td>8155</td>
    </tr>
    <tr>
      <th>2921</th>
      <td>2022-12-31</td>
      <td>263</td>
      <td>2167</td>
      <td>1806</td>
      <td>33.7</td>
      <td>2318</td>
      <td>9435</td>
    </tr>
  </tbody>
</table>
</div>

```python
display(weather.tail(3))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>rain(mm)</th>
      <th>humidity_max(%)</th>
      <th>humidity_min(%)</th>
      <th>sunshine(MJ/m2)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4015</th>
      <td>2022-12-29</td>
      <td>1.7</td>
      <td>-7.8</td>
      <td>0.0</td>
      <td>71.0</td>
      <td>34.0</td>
      <td>10.88</td>
    </tr>
    <tr>
      <th>4016</th>
      <td>2022-12-30</td>
      <td>2.1</td>
      <td>-4.0</td>
      <td>0.0</td>
      <td>87.0</td>
      <td>38.0</td>
      <td>10.84</td>
    </tr>
    <tr>
      <th>4017</th>
      <td>2022-12-31</td>
      <td>-4.4</td>
      <td>-4.4</td>
      <td>0.0</td>
      <td>66.0</td>
      <td>66.0</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div>

```python
plt.figure(figsize=(50, 8))
sns.lineplot(data=data, x='Date', y='avg_ride_distance')
plt.show()
```

![z_min_2_2_1_22](https://github.com/zacinthepark/TIL/assets/86648892/fbcd841c-59ed-45ad-b405-bf4874ac96a7)v

```python
# 익일의 대기시간(waiting time)을 오늘의 데이터를 활용하여 예측 해야하는 대상(target)으로 설정
data['target'] = data['avg_wait_time'].shift(-1)
data.pop('avg_wait_time')
data['target'] = data['target'].fillna(np.round(data['target'].interpolate(method='linear')))
```

```python
display(data.head(5))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-01</td>
      <td>213</td>
      <td>1023</td>
      <td>924</td>
      <td>2427</td>
      <td>10764</td>
      <td>17.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-02</td>
      <td>420</td>
      <td>3158</td>
      <td>2839</td>
      <td>2216</td>
      <td>8611</td>
      <td>26.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-03</td>
      <td>209</td>
      <td>1648</td>
      <td>1514</td>
      <td>2377</td>
      <td>10198</td>
      <td>24.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04</td>
      <td>196</td>
      <td>1646</td>
      <td>1526</td>
      <td>2431</td>
      <td>10955</td>
      <td>26.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-05</td>
      <td>421</td>
      <td>4250</td>
      <td>3730</td>
      <td>2214</td>
      <td>8663</td>
      <td>23.6</td>
    </tr>
  </tbody>
</table>
</div>

```python
display(data.tail(5))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2917</th>
      <td>2022-12-27</td>
      <td>669</td>
      <td>5635</td>
      <td>4654</td>
      <td>2198</td>
      <td>8178</td>
      <td>44.8</td>
    </tr>
    <tr>
      <th>2918</th>
      <td>2022-12-28</td>
      <td>607</td>
      <td>5654</td>
      <td>4648</td>
      <td>2161</td>
      <td>7882</td>
      <td>52.5</td>
    </tr>
    <tr>
      <th>2919</th>
      <td>2022-12-29</td>
      <td>581</td>
      <td>5250</td>
      <td>4247</td>
      <td>2229</td>
      <td>8433</td>
      <td>38.3</td>
    </tr>
    <tr>
      <th>2920</th>
      <td>2022-12-30</td>
      <td>600</td>
      <td>5293</td>
      <td>4200</td>
      <td>2183</td>
      <td>8155</td>
      <td>33.7</td>
    </tr>
    <tr>
      <th>2921</th>
      <td>2022-12-31</td>
      <td>263</td>
      <td>2167</td>
      <td>1806</td>
      <td>2318</td>
      <td>9435</td>
      <td>34.0</td>
    </tr>
  </tbody>
</table>
</div>

### (2) 날씨 데이터 붙이기

* merge를 활용합니다. 기준은 운행정보 입니다.

```python
# 익일의 실제 날씨 데이터를 전일에 발표된 예보데이터로 판단
weather['Date'] = weather['Date'] - pd.DateOffset(days=1)
display(weather.head(3))
display(weather.tail(3))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>rain(mm)</th>
      <th>humidity_max(%)</th>
      <th>humidity_min(%)</th>
      <th>sunshine(MJ/m2)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-12-31</td>
      <td>0.4</td>
      <td>-6.6</td>
      <td>0.0</td>
      <td>77.0</td>
      <td>45.0</td>
      <td>4.90</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2012-01-01</td>
      <td>-1.2</td>
      <td>-8.3</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>48.0</td>
      <td>6.16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2012-01-02</td>
      <td>-0.4</td>
      <td>-6.6</td>
      <td>0.4</td>
      <td>86.0</td>
      <td>45.0</td>
      <td>4.46</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>rain(mm)</th>
      <th>humidity_max(%)</th>
      <th>humidity_min(%)</th>
      <th>sunshine(MJ/m2)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4015</th>
      <td>2022-12-28</td>
      <td>1.7</td>
      <td>-7.8</td>
      <td>0.0</td>
      <td>71.0</td>
      <td>34.0</td>
      <td>10.88</td>
    </tr>
    <tr>
      <th>4016</th>
      <td>2022-12-29</td>
      <td>2.1</td>
      <td>-4.0</td>
      <td>0.0</td>
      <td>87.0</td>
      <td>38.0</td>
      <td>10.84</td>
    </tr>
    <tr>
      <th>4017</th>
      <td>2022-12-30</td>
      <td>-4.4</td>
      <td>-4.4</td>
      <td>0.0</td>
      <td>66.0</td>
      <td>66.0</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div>

```python
df = pd.merge(data, weather, on='Date')
display(df.head(5))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>target</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>rain(mm)</th>
      <th>humidity_max(%)</th>
      <th>humidity_min(%)</th>
      <th>sunshine(MJ/m2)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-01</td>
      <td>213</td>
      <td>1023</td>
      <td>924</td>
      <td>2427</td>
      <td>10764</td>
      <td>17.2</td>
      <td>-2.0</td>
      <td>-8.9</td>
      <td>0.0</td>
      <td>63.0</td>
      <td>28.0</td>
      <td>9.07</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-02</td>
      <td>420</td>
      <td>3158</td>
      <td>2839</td>
      <td>2216</td>
      <td>8611</td>
      <td>26.2</td>
      <td>2.4</td>
      <td>-9.2</td>
      <td>0.0</td>
      <td>73.0</td>
      <td>37.0</td>
      <td>8.66</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-03</td>
      <td>209</td>
      <td>1648</td>
      <td>1514</td>
      <td>2377</td>
      <td>10198</td>
      <td>24.5</td>
      <td>8.2</td>
      <td>0.2</td>
      <td>0.0</td>
      <td>89.0</td>
      <td>58.0</td>
      <td>5.32</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04</td>
      <td>196</td>
      <td>1646</td>
      <td>1526</td>
      <td>2431</td>
      <td>10955</td>
      <td>26.2</td>
      <td>7.9</td>
      <td>-0.9</td>
      <td>0.0</td>
      <td>95.0</td>
      <td>52.0</td>
      <td>6.48</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-05</td>
      <td>421</td>
      <td>4250</td>
      <td>3730</td>
      <td>2214</td>
      <td>8663</td>
      <td>23.6</td>
      <td>4.1</td>
      <td>-7.4</td>
      <td>3.4</td>
      <td>98.0</td>
      <td>29.0</td>
      <td>10.47</td>
    </tr>
  </tbody>
</table>
</div>

### (3) 새로운 feature를 생성해 봅시다.

* 날짜와 관련된 변수 추가하기 : 요일, 월, 계절, 연도
* 그외 새로운 feature 도출 : 최소 2개 이상
* 예 : 공휴일, 최근 7주일간의 평균 대기시간, 탑승률 등

#### 1) 날짜와 관련된 변수 추가하기 : 요일, 월, 계절, 연도

* 요일 이름, 계절이름, 월 이름으로 만드는 경우에는, 변수를 pd.Categorical로 범주형을 만들면서 순서를 지정하는 것이 이후 그래프를 그릴 때 순서대로 표현할 수 있습니다.

```python
df['weekday'] = df['Date'].dt.day_name()
df['weekday'] = pd.Categorical(df['weekday'],
                                  categories=['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'])
df['month'] = df['Date'].dt.month

df['season'] = np.where(df['month'].isin([3,4,5]), 'Spring',
                           np.where(df['month'].isin([6,7,8]), 'Summer',
                                    np.where(df['month'].isin([9,10,11]), 'Fall', 'Winter')))
df['season'] = pd.Categorical(df['season'], categories=['Spring','Summer','Fall','Winter'])

df['year'] = df['Date'].dt.year

# 요일 변수 추가
df['weekend'] = df['weekday'].map(lambda x: 1 if x in ['Saturday', 'Sunday'] else 0)
```

#### 코로나 기간 생각해보며 시각화 진행

```python
plt.figure(figsize=(30, 8))
sns.lineplot(data=data, x='Date', y='receipt')
plt.show()
```

![z_min_2_2_1_23](https://github.com/zacinthepark/TIL/assets/86648892/380f5ee7-5b19-46f6-8a1c-3862e4552026)

```python
plt.figure(figsize=(30, 8))
sns.lineplot(data=data, x='Date', y='boarding')
plt.show()
```

![z_min_2_2_1_24](https://github.com/zacinthepark/TIL/assets/86648892/724a84b4-cea7-4dcc-a5ef-67ed9028f51f)

```python
plt.figure(figsize=(30, 8))
sns.lineplot(data=data, x='Date', y='target')
plt.show()
```

![z_min_2_2_1_25](https://github.com/zacinthepark/TIL/assets/86648892/4514c350-9b51-49de-b363-cc1d5e7912e0)

```python
# 코로나 컬럼 추가
"""
https://www.phwr.org/journal/view.html?uid=75&vmd=Full
https://terms.naver.com/entry.naver?docId=5928090&cid=42107&categoryId=42107
"""
corona_start_date = pd.to_datetime('2020-01-20')
corona_end_date = pd.to_datetime('2022-04-18')  # 사회적 거리두기 해제

df['covid_19'] = df['Date'].apply(lambda x: 1 if corona_start_date <= x <= corona_end_date else 0)
```

#### 2) 공휴일 정보

* workalendar 패키지를 설치하고, 대한민국 공휴일 정보를 끌어와 봅시다.
* 휴무일 데이터 패키지 설치

```python
# !pip install workalendar
```

* 간단 사용법

```python
from workalendar.asia import SouthKorea
cal = SouthKorea()
pd.DataFrame(cal.holidays(2023))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-01-01</td>
      <td>New year</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-01-21</td>
      <td>Korean New Year's Day</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-01-22</td>
      <td>Korean New Year's Day</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-01-23</td>
      <td>Korean New Year's Day</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-03-01</td>
      <td>Independence Day</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2023-05-05</td>
      <td>Children's Day</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2023-05-26</td>
      <td>Buddha's Birthday</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2023-06-06</td>
      <td>Memorial Day</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2023-08-15</td>
      <td>Liberation Day</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2023-09-28</td>
      <td>Midautumn Festival</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2023-09-29</td>
      <td>Midautumn Festival</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2023-09-30</td>
      <td>Midautumn Festival</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2023-10-03</td>
      <td>National Foundation Day</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2023-10-09</td>
      <td>Hangul Day</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2023-12-25</td>
      <td>Christmas Day</td>
    </tr>
  </tbody>
</table>
</div>

* 휴무일 데이터셋 만들기 2015 ~ 2022
* 실제로 휴무일에 해당하지만 workalendar 라이브러리에 없는 날짜는 직접 추가해봅시다.
* 휴무일 장애인 콜택시의 접수건 변화에 대한 특징을 찾아 이를 바탕으로 데이터를 조회하여 찾아볼 수 있다.

```python
from workalendar.asia import SouthKorea

cal = SouthKorea()
holiday = pd.DataFrame()
for y in range(2015, 2023) :
    holiday = pd.concat([holiday, pd.DataFrame(cal.holidays(y))], axis = 0)

holiday.columns = ['Date', 'holiday']
holiday['Date'] = pd.to_datetime(holiday['Date'])
holiday['holiday'] = 1
display(holiday)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>holiday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-01</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-02-18</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-02-19</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-02-20</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-03-01</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2022-09-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2022-09-11</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2022-10-03</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2022-10-09</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2022-12-25</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>120 rows × 2 columns</p>
</div>

* 기존 데이터에 휴무일 정보 결합하기.
* 휴무일이 아닌 날짜는 0으로 저장하시오.

```python
df = pd.merge(df, holiday, how='left')
df = df.fillna({'holiday': 0})
```

```python
display(df.head(5))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>target</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>rain(mm)</th>
      <th>humidity_max(%)</th>
      <th>humidity_min(%)</th>
      <th>sunshine(MJ/m2)</th>
      <th>weekday</th>
      <th>month</th>
      <th>season</th>
      <th>year</th>
      <th>weekend</th>
      <th>covid_19</th>
      <th>holiday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-01</td>
      <td>213</td>
      <td>1023</td>
      <td>924</td>
      <td>2427</td>
      <td>10764</td>
      <td>17.2</td>
      <td>-2.0</td>
      <td>-8.9</td>
      <td>0.0</td>
      <td>63.0</td>
      <td>28.0</td>
      <td>9.07</td>
      <td>Thursday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-02</td>
      <td>420</td>
      <td>3158</td>
      <td>2839</td>
      <td>2216</td>
      <td>8611</td>
      <td>26.2</td>
      <td>2.4</td>
      <td>-9.2</td>
      <td>0.0</td>
      <td>73.0</td>
      <td>37.0</td>
      <td>8.66</td>
      <td>Friday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-03</td>
      <td>209</td>
      <td>1648</td>
      <td>1514</td>
      <td>2377</td>
      <td>10198</td>
      <td>24.5</td>
      <td>8.2</td>
      <td>0.2</td>
      <td>0.0</td>
      <td>89.0</td>
      <td>58.0</td>
      <td>5.32</td>
      <td>Saturday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04</td>
      <td>196</td>
      <td>1646</td>
      <td>1526</td>
      <td>2431</td>
      <td>10955</td>
      <td>26.2</td>
      <td>7.9</td>
      <td>-0.9</td>
      <td>0.0</td>
      <td>95.0</td>
      <td>52.0</td>
      <td>6.48</td>
      <td>Sunday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-05</td>
      <td>421</td>
      <td>4250</td>
      <td>3730</td>
      <td>2214</td>
      <td>8663</td>
      <td>23.6</td>
      <td>4.1</td>
      <td>-7.4</td>
      <td>3.4</td>
      <td>98.0</td>
      <td>29.0</td>
      <td>10.47</td>
      <td>Monday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

#### 3) 7일 이동평균 대기시간

* rolling().mean() 사용

```python
# 결측치 처리를 위해 min_periods = 1 의 값으로, 최소 1개의 값이 있을때에도, 이동평균 계산
df['day7_avg_wait_time'] = df['target'].rolling(window=7, min_periods=1).mean()
```

#### 4) 탑승률

```python
# 탑승률 = 탑승건 / 접수건
df['ride_ratio'] = np.round((df['boarding'] / df['receipt']), 2)
```

```python
display(df.head(5))
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>count_taxi</th>
      <th>receipt</th>
      <th>boarding</th>
      <th>avg_rate</th>
      <th>avg_ride_distance</th>
      <th>target</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>rain(mm)</th>
      <th>...</th>
      <th>sunshine(MJ/m2)</th>
      <th>weekday</th>
      <th>month</th>
      <th>season</th>
      <th>year</th>
      <th>weekend</th>
      <th>covid_19</th>
      <th>holiday</th>
      <th>day7_avg_wait_time</th>
      <th>ride_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-01</td>
      <td>213</td>
      <td>1023</td>
      <td>924</td>
      <td>2427</td>
      <td>10764</td>
      <td>17.2</td>
      <td>-2.0</td>
      <td>-8.9</td>
      <td>0.0</td>
      <td>...</td>
      <td>9.07</td>
      <td>Thursday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>17.200000</td>
      <td>0.90</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-02</td>
      <td>420</td>
      <td>3158</td>
      <td>2839</td>
      <td>2216</td>
      <td>8611</td>
      <td>26.2</td>
      <td>2.4</td>
      <td>-9.2</td>
      <td>0.0</td>
      <td>...</td>
      <td>8.66</td>
      <td>Friday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>21.700000</td>
      <td>0.90</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-03</td>
      <td>209</td>
      <td>1648</td>
      <td>1514</td>
      <td>2377</td>
      <td>10198</td>
      <td>24.5</td>
      <td>8.2</td>
      <td>0.2</td>
      <td>0.0</td>
      <td>...</td>
      <td>5.32</td>
      <td>Saturday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>22.633333</td>
      <td>0.92</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04</td>
      <td>196</td>
      <td>1646</td>
      <td>1526</td>
      <td>2431</td>
      <td>10955</td>
      <td>26.2</td>
      <td>7.9</td>
      <td>-0.9</td>
      <td>0.0</td>
      <td>...</td>
      <td>6.48</td>
      <td>Sunday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>23.525000</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-05</td>
      <td>421</td>
      <td>4250</td>
      <td>3730</td>
      <td>2214</td>
      <td>8663</td>
      <td>23.6</td>
      <td>4.1</td>
      <td>-7.4</td>
      <td>3.4</td>
      <td>...</td>
      <td>10.47</td>
      <td>Monday</td>
      <td>1</td>
      <td>Winter</td>
      <td>2015</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>23.540000</td>
      <td>0.88</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div>

#### 5) 평균 온도 & 평균 습도

```python
df['temp_avg'] = np.round((df['temp_max'] + df['temp_min']) / 2, 1)
df['humidity_avg'] = np.round((df['humidity_max(%)'] + df['humidity_min(%)']) / 2, 1)

display(df.head().T)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Date</th>
      <td>2015-01-01 00:00:00</td>
      <td>2015-01-02 00:00:00</td>
      <td>2015-01-03 00:00:00</td>
      <td>2015-01-04 00:00:00</td>
      <td>2015-01-05 00:00:00</td>
    </tr>
    <tr>
      <th>count_taxi</th>
      <td>213</td>
      <td>420</td>
      <td>209</td>
      <td>196</td>
      <td>421</td>
    </tr>
    <tr>
      <th>receipt</th>
      <td>1023</td>
      <td>3158</td>
      <td>1648</td>
      <td>1646</td>
      <td>4250</td>
    </tr>
    <tr>
      <th>boarding</th>
      <td>924</td>
      <td>2839</td>
      <td>1514</td>
      <td>1526</td>
      <td>3730</td>
    </tr>
    <tr>
      <th>avg_rate</th>
      <td>2427</td>
      <td>2216</td>
      <td>2377</td>
      <td>2431</td>
      <td>2214</td>
    </tr>
    <tr>
      <th>avg_ride_distance</th>
      <td>10764</td>
      <td>8611</td>
      <td>10198</td>
      <td>10955</td>
      <td>8663</td>
    </tr>
    <tr>
      <th>target</th>
      <td>17.2</td>
      <td>26.2</td>
      <td>24.5</td>
      <td>26.2</td>
      <td>23.6</td>
    </tr>
    <tr>
      <th>temp_max</th>
      <td>-2.0</td>
      <td>2.4</td>
      <td>8.2</td>
      <td>7.9</td>
      <td>4.1</td>
    </tr>
    <tr>
      <th>temp_min</th>
      <td>-8.9</td>
      <td>-9.2</td>
      <td>0.2</td>
      <td>-0.9</td>
      <td>-7.4</td>
    </tr>
    <tr>
      <th>rain(mm)</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.4</td>
    </tr>
    <tr>
      <th>humidity_max(%)</th>
      <td>63.0</td>
      <td>73.0</td>
      <td>89.0</td>
      <td>95.0</td>
      <td>98.0</td>
    </tr>
    <tr>
      <th>humidity_min(%)</th>
      <td>28.0</td>
      <td>37.0</td>
      <td>58.0</td>
      <td>52.0</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>sunshine(MJ/m2)</th>
      <td>9.07</td>
      <td>8.66</td>
      <td>5.32</td>
      <td>6.48</td>
      <td>10.47</td>
    </tr>
    <tr>
      <th>weekday</th>
      <td>Thursday</td>
      <td>Friday</td>
      <td>Saturday</td>
      <td>Sunday</td>
      <td>Monday</td>
    </tr>
    <tr>
      <th>month</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>season</th>
      <td>Winter</td>
      <td>Winter</td>
      <td>Winter</td>
      <td>Winter</td>
      <td>Winter</td>
    </tr>
    <tr>
      <th>year</th>
      <td>2015</td>
      <td>2015</td>
      <td>2015</td>
      <td>2015</td>
      <td>2015</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>covid_19</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>holiday</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>day7_avg_wait_time</th>
      <td>17.2</td>
      <td>21.7</td>
      <td>22.633333</td>
      <td>23.525</td>
      <td>23.54</td>
    </tr>
    <tr>
      <th>ride_ratio</th>
      <td>0.9</td>
      <td>0.9</td>
      <td>0.92</td>
      <td>0.93</td>
      <td>0.88</td>
    </tr>
    <tr>
      <th>temp_avg</th>
      <td>-5.4</td>
      <td>-3.4</td>
      <td>4.2</td>
      <td>3.5</td>
      <td>-1.7</td>
    </tr>
    <tr>
      <th>humidity_avg</th>
      <td>45.5</td>
      <td>55.0</td>
      <td>73.5</td>
      <td>73.5</td>
      <td>63.5</td>
    </tr>
  </tbody>
</table>
</div>

#### holiday, weekend 관계

```python
# 시각화
plt.figure(figsize=(10, 5))

# 주말에 따른 대기시간 평균
plt.subplot(1, 2, 1)
sns.barplot(x='weekend', y='target', data=df, palette='coolwarm')
plt.xlabel('주말 여부')
plt.ylabel('대기시간(target) 평균')
plt.xticks(ticks=[0, 1], labels=['평일', '주말'])

# 공휴일에 따른 대기시간 평균
plt.subplot(1, 2, 2)
sns.barplot(x='holiday', y='target', data=df, palette='coolwarm')
plt.xlabel('공휴일 여부')
plt.ylabel('대기시간(target) 평균')
plt.xticks(ticks=[0, 1], labels=['평일', '공휴일'])

plt.show()
```

![z_min_2_2_1_26](https://github.com/zacinthepark/TIL/assets/86648892/cafebb45-4fad-40e4-86df-438a93bcddce)

```python
# 주말 + 공휴일 을 합치면?
df['weekend_holiday'] = df[['weekend', 'holiday']].apply(lambda x : np.max(x), axis=1)

# 시각화
plt.figure(figsize=(10, 5))

# 주말에 따른 대기시간 평균
plt.subplot(1, 3, 1)
sns.barplot(x='weekend', y='target', data = df, palette='coolwarm')
plt.xlabel('주말 여부')
plt.ylabel('대기시간(target) 평균')
plt.xticks(ticks=[0, 1], labels=['평일', '주말'])

# 공휴일에 따른 대기시간 평균
plt.subplot(1, 3, 2)
sns.barplot(x='holiday', y='target', data = df, palette='coolwarm')
plt.xlabel('공휴일 여부')
plt.ylabel('대기시간(target) 평균')
plt.xticks(ticks=[0, 1], labels=['평일', '공휴일'])

# 주말 & 공휴일 따른 대기시간 평균
plt.subplot(1, 3, 3)
sns.barplot(x='holiday', y='target', data = df, palette='coolwarm')
plt.xlabel('주말 또는 공휴일 여부')
plt.ylabel('대기시간(target) 평균')
plt.xticks(ticks=[0, 1], labels=['평일', '주말 또는 공휴일'])

plt.show()
```

![z_min_2_2_1_27](https://github.com/zacinthepark/TIL/assets/86648892/c1c4fd1d-61ac-4f71-904f-a54fad8d121b)

#### 장애인콜택시 기본요금

> 관련 자료 링크

* 장애인 콜택시: https://www.sisul.or.kr/open_content/calltaxi/introduce/intro.jsp
* 장애인 콜택시 이용요금: https://www.sisul.or.kr/open_content/calltaxi/introduce/receipt.jsp
* 2015년 과거 장애인콜택시 기사: https://m.blog.naver.com/120seoulcall/220317404447

* 장애인콜택시 현재 요금

![z_min_2_2_1_28](https://github.com/zacinthepark/TIL/assets/86648892/3119ae7c-8b32-47e0-a746-275af8695b94)

* 2016년 9월 이전까지 (2015-01-01~ 2016-08-31)

![z_min_2_2_1_29](https://github.com/zacinthepark/TIL/assets/86648892/aa283c4c-fa1a-4a4d-b24f-360b21248b25)

* 시도를 해보았지만, 유의미한 결과를 얻어낼 수 없었다.

## 4.데이터 저장

* joblib을 사용하여 작업 경로에 정리한 데이터프레임을 저장합니다.
* 저장파일이름 : data1.pkl

```python
# df.to_pickle('data1_1.pkl')
```
