## Fixtures

---

프로젝트를 시작할 때 모델에 초기 데이터를 제공하는 방법

### 초기 데이터의 필요성

- 협업의 경우
    - gitignore 설정으로 인해 DB(venv, db.sqlite3)는 업로드하지 않음
    - requirements.txt로 설정 대체
    - Django에서는 fixtures를 사용해 앱에 초기 데이터(Initial data)를 제공할 수 있음
    - 즉, migrations와 fixtures를 사용하여 data와 구조를 공유하게 됨

### Providing data with fixtures

- Fixtures?
    - Django가 데이터베이스로 가져오는 방법을 알고 있는 데이터 모음
    - 가져오는 방법을 알고있다?
        - Django가 데이터들을 하나의 구조화된 파일로 만듬
        - 다른 프로젝트에서 같은 모델 구조로 일치한다면
            - 그대로 import하여 초기 데이터를 넣은 상태로 시작 가능

### fixtures 생성 및 로드

- `app_name/fixtures/` 가 기본 경로
    - Django는 설치된 모든 app의 디렉토리에서 fixtures 폴더 이후의 경로로 fixtures 파일을 찾음

- **fixtures 파일은 직접 만드는 것이 아니라 dumpdata를 사용하여 생성하는 것이다**
    - **dumpdata의 출력 결과물은 loaddata의 입력으로 사용됨**

### 생성 (데이터 추출)

- `dumpdata`
    - 응용 프로그램과 관련된 데이터베이스의 모든 데이터를 표준 출력으로 출력함
    - 여러 모델을 하나의 json 파일로 만들 수 있음
    - `python manage.py dumpdata [app_name[.ModelName] [app_name[.ModelName]] ...]] > {filename}.json`
        - `>` 앞에서 나온 문자열을 json 파일로 만들겠다는 것
    - `python manage.py dumpdata --indent 4 articles.article > articles.json`
        - articles 앱에 있는 article 모델 데이터를 articles.json으로 추출하겠다는 뜻
        - manage.py와 동일한 위치에 data가 담긴 articles.json 파일이 생성됨
        - `--indent 4` 는 옵션

  ```python
  # -Xutf8이라는 옵션을 통해 유니코드 형태로 인코딩 설정

  python -Xutf8 mange.py dumpdata --indent 4 articles.comment > comment.json
  ```

- 추가로 나머지 모델에 대한 데이터를 dump
- `python manage.py dumpdata --indent 4 articles.user > users.json`
- `python manage.py dumpdata --indent 4 articles.comment > comments.json`

### [참고] 모든 모델을 한번에 dump하기

<img width="1047" alt="dj_191" src="https://user-images.githubusercontent.com/86648892/212547694-ea233db8-e783-444d-aa7f-5857b96502b7.png">

### 로드 (데이터 입력)

- `loaddata`
    - migrate 우선 진행
        - `python manage.py migrate`
    - 데이터 로드
        - `python manage.py loaddata articles/article.json`
        - `python manage.py loaddata articles.json comments.json users.json`
        - namespace 따로 설정안했다면 그냥 파일 이름 적어주면 됨
        - 띄어쓰기해서 한번에 로드 가능
    - 외래키에 의해 관계가 정해진 모델이 있다면 먼저 로드가 되어있어야 함
        - user - article - comment 순으로 로드하는 것이 좋음
        - 한번에 로드하는 경우는 순서를 알아서 매칭시켜줌
- dumpdata해서 만든 것을 약속된 기본 경로에 넣어줘야 load할 때 읽을 수 있음

### [참고] loaddata를 하는 순서

<img width="1182" alt="dj_192" src="https://user-images.githubusercontent.com/86648892/212547690-67bb0dfb-2924-42f5-a3d3-a4bbbc8a6cc4.png">

### [참고] loaddata 시 encoding codec 관련 에러가 발생하는 경우

<img width="1188" alt="dj_193" src="https://user-images.githubusercontent.com/86648892/212547681-dc067f4e-f0aa-4d03-b494-411e50f687c5.png">
