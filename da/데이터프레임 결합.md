# **데이터프레임 결합**

## **1.환경준비**

* 라이브러리 불러오기

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
```

* 데이터 가져오기

```python
sales = pd.read_csv("https://raw.githubusercontent.com/DA4BAM/dataset/master/ts_sales_simple.csv")

sales1 = sales.loc[sales['Store_ID']==1]
sales2 = sales.loc[sales['Store_ID']==2]
sales5 = sales.loc[sales['Store_ID']==5]
sales11 = sales.loc[sales['Store_ID']==11]

products = pd.read_csv("https://raw.githubusercontent.com/DA4BAM/dataset/master/ts_product_master.csv")
stores = pd.read_csv("https://raw.githubusercontent.com/DA4BAM/dataset/master/ts_store_master.csv")
```

```python
sales1.head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order_ID</th>
      <th>Date</th>
      <th>Store_ID</th>
      <th>Qty</th>
      <th>Product_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>

```python
products.head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Product_ID</th>
      <th>Product_Code</th>
      <th>SubCategory</th>
      <th>Category</th>
      <th>LeadTime</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20</td>
      <td>HG001</td>
      <td>Gardening Tools</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>27</td>
      <td>HH001</td>
      <td>Home Appliances</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>150</td>
    </tr>
    <tr>
      <th>2</th>
      <td>16</td>
      <td>HK001</td>
      <td>Kitchen</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>23</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>HK002</td>
      <td>Kitchen</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>41</td>
    </tr>
    <tr>
      <th>4</th>
      <td>32</td>
      <td>GS001</td>
      <td>Seafood</td>
      <td>Grocery</td>
      <td>3</td>
      <td>34</td>
    </tr>
  </tbody>
</table>
</div>

```python
stores.head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store_ID</th>
      <th>City</th>
      <th>State</th>
      <th>Store_Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Oklahoma City</td>
      <td>Oklahoma</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

## **2.결합1 : 붙이기 concat()**

- 매핑 기준: 인덱스(행), 컬럼 이름(열)

![image](https://github.com/zacinthepark/TIL/assets/86648892/c2a235e7-466c-4490-a8fc-d17c963e52d2)

- 방향 axis = 0
    - 세로(행)로 합치기 (위, 아래로 붙여라)
    - 컬럼 이름 기준

- 방법 join
    - 'outer': 모든 행과 열 합치기 (기본값)
    - 'inner': 같은 행과 열만 합치기

![image](https://github.com/zacinthepark/TIL/assets/86648892/3233d73f-1e65-4bc4-aed0-760343f39d56)

- 방향 axis = 1
    - 가로(열)로 합치기 (옆으로 붙여라)
    - 행 인덱스 기준

- 방법 join
    - 'outer': 모든 행과 열 합치기 (기본값)
    - 'inner': 같은 행과 열만 합치기

* 데이터를 생성해 봅시다.

```python
df1 = pd.DataFrame({'A':[10,25], 'B':[15,30]})
df2 = pd.DataFrame({'A':[20,30,50], 'C':[35,30,40]})
df2.drop([1], inplace = True)

display(df1)
display(df2)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>15</td>
    </tr>
    <tr>
      <th>1</th>
      <td>25</td>
      <td>30</td>
    </tr>
  </tbody>
</table>
</div>


<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20</td>
      <td>35</td>
    </tr>
    <tr>
      <th>2</th>
      <td>50</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div>

### **(1) 세로로 합치기 : axis = 0**

* join = 'inner'

```python
pd.concat([df1, df2], axis = 0, join = 'inner')
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>25</td>
    </tr>
    <tr>
      <th>0</th>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div>

```python
pd.concat([df1, df2], axis = 0, join = 'inner').reset_index(drop = True)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div>

* join = 'outer'

```python
pd.concat([df1, df2], axis = 0, join = 'outer')
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>15.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>25</td>
      <td>30.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>0</th>
      <td>20</td>
      <td>NaN</td>
      <td>35.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>50</td>
      <td>NaN</td>
      <td>40.0</td>
    </tr>
  </tbody>
</table>
</div>

### **(2) 가로로 합치기 : axis = 1**

- 추가 속성을 만들어서 각 레코드들에 붙이고 싶을 때

* join = 'inner'

```python
pd.concat([df1, df2], axis = 1, join = 'inner')
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>15</td>
      <td>20</td>
      <td>35</td>
    </tr>
  </tbody>
</table>
</div>

* join = 'outer'

```python
pd.concat([df1, df2], axis = 1, join = 'outer')
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10.0</td>
      <td>15.0</td>
      <td>20.0</td>
      <td>35.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>25.0</td>
      <td>30.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>50.0</td>
      <td>40.0</td>
    </tr>
  </tbody>
</table>
</div>

> 연습문제

[문1] sales1,2,5,11 데이터프레임을 하나로 합칩시다. 어떻게 합치는게 좋을까요?

```python
temp = pd.concat([sales1, sales2, sales5, sales11], axis=0, join='inner')
temp
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order_ID</th>
      <th>Date</th>
      <th>Store_ID</th>
      <th>Qty</th>
      <th>Product_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.000</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.000</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.000</td>
      <td>10</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>24340</th>
      <td>53548</td>
      <td>2013-01-31</td>
      <td>11</td>
      <td>10.000</td>
      <td>22</td>
    </tr>
    <tr>
      <th>24341</th>
      <td>53550</td>
      <td>2013-01-31</td>
      <td>11</td>
      <td>641.507</td>
      <td>24</td>
    </tr>
    <tr>
      <th>24342</th>
      <td>53553</td>
      <td>2013-01-31</td>
      <td>11</td>
      <td>0.000</td>
      <td>27</td>
    </tr>
    <tr>
      <th>24343</th>
      <td>53555</td>
      <td>2013-01-31</td>
      <td>11</td>
      <td>27.000</td>
      <td>29</td>
    </tr>
    <tr>
      <th>24344</th>
      <td>53558</td>
      <td>2013-01-31</td>
      <td>11</td>
      <td>13.000</td>
      <td>32</td>
    </tr>
  </tbody>
</table>
<p>1860 rows × 5 columns</p>
</div>

[문2] (조금 어려운 문제!)  

일별, 매장별 판매량 합계를 구해 봅시다.  

groupby, pd.concat 을 이용하여 다음과 같은 결과를 얻도록 코드를 작성해봅시다.

* 힌트

    * 1) sales1, 2, 5,11 로 부터 각각 일별 판매량 합계 집계하기
        * 집계시 .agg() 를 이용하여 열이름 변경하거나, 집계후 열이름 변경하기
    * 2) pd.concat 으로 가로로 합치기

```python
# groupby
s1 = sales1.groupby('Date', as_index=False)['Qty'].sum()
s1.rename(columns={'Qty': 'Qty1'}, inplace=True)

s2 = sales2.groupby('Date', as_index=False)['Qty'].sum()
s2.rename(columns={'Qty': 'Qty2'}, inplace=True)
s2.drop('Date', axis=1, inplace=True)

s5 = sales5.groupby('Date', as_index=False)['Qty'].sum()
s5.rename(columns={'Qty': 'Qty5'}, inplace=True)
s5.drop('Date', axis=1, inplace=True)

s11 = sales11.groupby('Date', as_index=False)['Qty'].sum()
s11.rename(columns={'Qty': 'Qty11'}, inplace=True)
s11.drop('Date', axis=1, inplace=True)

# concat
s = pd.concat([s1, s2, s5, s11], axis=1, join='inner')  # inner 시 모든 store가 Qty가 존재하는 날짜만 concat
display(s)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Qty1</th>
      <th>Qty2</th>
      <th>Qty5</th>
      <th>Qty11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-01-01</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-01-02</td>
      <td>6760.782000</td>
      <td>9221.338001</td>
      <td>9404.229020</td>
      <td>16593.312000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-01-03</td>
      <td>5348.384001</td>
      <td>6830.089000</td>
      <td>6932.685000</td>
      <td>11032.676040</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-01-04</td>
      <td>5390.445001</td>
      <td>6742.984000</td>
      <td>6567.938000</td>
      <td>10962.687002</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-01-05</td>
      <td>5787.839000</td>
      <td>8583.055000</td>
      <td>7276.800000</td>
      <td>13315.896000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2013-01-06</td>
      <td>2007.194000</td>
      <td>9317.139000</td>
      <td>9578.077030</td>
      <td>14165.615050</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2013-01-07</td>
      <td>5639.396000</td>
      <td>6047.629000</td>
      <td>5729.203000</td>
      <td>9946.420000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2013-01-08</td>
      <td>5131.128000</td>
      <td>5545.928020</td>
      <td>5716.248000</td>
      <td>9258.956000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2013-01-09</td>
      <td>6198.154980</td>
      <td>6061.471020</td>
      <td>5352.507000</td>
      <td>8644.922000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2013-01-10</td>
      <td>4309.750000</td>
      <td>5070.431000</td>
      <td>5319.121020</td>
      <td>8470.169000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2013-01-11</td>
      <td>5053.745980</td>
      <td>5822.891982</td>
      <td>5786.585000</td>
      <td>7316.129000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2013-01-12</td>
      <td>5073.569980</td>
      <td>7479.722000</td>
      <td>6246.480000</td>
      <td>10959.593000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2013-01-13</td>
      <td>2482.635000</td>
      <td>9059.072000</td>
      <td>8299.981000</td>
      <td>10857.623960</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2013-01-14</td>
      <td>5192.406000</td>
      <td>5404.198000</td>
      <td>5398.938000</td>
      <td>7789.259030</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2013-01-15</td>
      <td>4774.043000</td>
      <td>5255.754000</td>
      <td>5528.819000</td>
      <td>8215.977970</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2013-01-16</td>
      <td>6210.563002</td>
      <td>6543.510000</td>
      <td>6147.083980</td>
      <td>7540.355000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2013-01-17</td>
      <td>4544.486000</td>
      <td>5214.799020</td>
      <td>5109.820000</td>
      <td>7395.201000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2013-01-18</td>
      <td>5419.165001</td>
      <td>6668.457000</td>
      <td>5043.555000</td>
      <td>7918.020000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2013-01-19</td>
      <td>5447.259000</td>
      <td>8016.393000</td>
      <td>6228.933000</td>
      <td>11044.523000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2013-01-20</td>
      <td>2153.939995</td>
      <td>8932.121020</td>
      <td>8204.085000</td>
      <td>11211.312000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2013-01-21</td>
      <td>4784.614020</td>
      <td>6380.861000</td>
      <td>5511.559999</td>
      <td>9088.764040</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2013-01-22</td>
      <td>4922.417000</td>
      <td>5658.953001</td>
      <td>5426.481000</td>
      <td>7967.939000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2013-01-23</td>
      <td>5770.343000</td>
      <td>6056.067000</td>
      <td>5624.662000</td>
      <td>7246.130000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2013-01-24</td>
      <td>4559.193000</td>
      <td>4608.736000</td>
      <td>5053.194000</td>
      <td>7802.938000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2013-01-25</td>
      <td>5144.064000</td>
      <td>6096.080000</td>
      <td>5591.837000</td>
      <td>7977.591980</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2013-01-26</td>
      <td>4820.926000</td>
      <td>7550.064982</td>
      <td>6232.117000</td>
      <td>10446.452000</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2013-01-27</td>
      <td>2242.990000</td>
      <td>8169.363000</td>
      <td>6562.350000</td>
      <td>10590.136000</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2013-01-28</td>
      <td>4484.428000</td>
      <td>5111.355000</td>
      <td>5595.128020</td>
      <td>8419.120000</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2013-01-29</td>
      <td>4285.201001</td>
      <td>5210.258000</td>
      <td>4720.338000</td>
      <td>6970.078000</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2013-01-30</td>
      <td>5634.577000</td>
      <td>5956.379000</td>
      <td>5071.153000</td>
      <td>7744.136020</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2013-01-31</td>
      <td>4341.563000</td>
      <td>4862.804996</td>
      <td>5230.479000</td>
      <td>8367.902000</td>
    </tr>
  </tbody>
</table>
</div>

## **3.결합 ① : 조인 join(merge)**

![pd_merge](https://github.com/zacinthepark/TIL/assets/86648892/3e59abd5-b2e3-445c-83c4-c162e1d214fa)

- 매핑 기준: 특정 컬럼(key)의 값 기준으로 결합
- 데이터베이스 테이블 조인과 같음
- 지정한 컬럼의 값을 기준으로 병합
    - 옆으로만 병합
    - 어떤 컬럼을 기준 삼을 것인가?
    - 방법 how
        - inner: 같은 값만
        - outer: 모두
        - left: 왼쪽 df는 모두, 오른쪽 df는 같은 값만
        - right: 오른쪽 df는 모두, 왼쪽 df는 같은 값만

* 판다스에서 join은 굉장히 간단합니다.
* 자동으로 key를 잡아줍니다
* default로 inner join을 합니다.

```python
df1 = pd.DataFrame({'A':[1,2], 'B':[15,30], 'C':[20, 25]})
df2 = pd.DataFrame({'A':[2,3], 'D':[20, 35]})

display(df1)
display(df2)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>15</td>
      <td>20</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>30</td>
      <td>25</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>35</td>
    </tr>
  </tbody>
</table>
</div>

### **(1) inner merge**

```python
# on은 기준 컬럼
pd.merge(df1, df2, how = 'inner', on = 'A')
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>30</td>
      <td>25</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div>

```python
# on을 생략하면 알아서 컬럼 이름이 같은 것을 찾아서 붙여줌
pd.merge(df1, df2, how = 'inner')
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>30</td>
      <td>25</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div>

### **(2) left merge**

```python
pd.merge(df1, df2, how = 'left')
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>15</td>
      <td>20</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>30</td>
      <td>25</td>
      <td>20.0</td>
    </tr>
  </tbody>
</table>
</div>

### **(3) right merge**

```python
pd.merge(df1, df2, how = 'right')
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>30.0</td>
      <td>25.0</td>
      <td>20</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>35</td>
    </tr>
  </tbody>
</table>
</div>

> 연습문제

[문1] 일별, 매장별 판매량 합계를 구해 봅시다.  

groupby, pd.merge 을 이용하여 다음과 같은 결과를 얻도록 코드를 작성해봅시다.

* 힌트

    * 1) sales1, 2, 5,11 로 부터 각각 일별 판매량 합계 집계하기
        * 집계시 .agg() 를 이용하여 열이름 변경하거나, 집계후 열이름 변경하기
    * 2) pd.merge 으로 결합하기

```python
# s1 = sales1.groupby('Date', as_index=False)['Qty'].sum()
# s1 = sales1.groupby('Date', as_index=False).agg({'Qty': 'sum'})
# s1.columns = ['Date', 'Qty1']

s1 = sales1.groupby('Date', as_index=False).agg(Qty1=('Qty', 'sum'))
s2 = sales2.groupby('Date', as_index=False).agg(Qty2=('Qty', 'sum'))
s5 = sales5.groupby('Date', as_index=False).agg(Qty5=('Qty', 'sum'))
s11 = sales11.groupby('Date', as_index=False).agg(Qty11=('Qty', 'sum'))

temp = pd.merge(s1, s2, on='Date', how='inner')
temp = pd.merge(temp, s5, on='Date', how='inner')
s = pd.merge(temp, s11, on='Date', how='inner')
s.head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Qty1</th>
      <th>Qty2</th>
      <th>Qty5</th>
      <th>Qty11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-01-01</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-01-02</td>
      <td>6760.782000</td>
      <td>9221.338001</td>
      <td>9404.22902</td>
      <td>16593.312000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-01-03</td>
      <td>5348.384001</td>
      <td>6830.089000</td>
      <td>6932.68500</td>
      <td>11032.676040</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-01-04</td>
      <td>5390.445001</td>
      <td>6742.984000</td>
      <td>6567.93800</td>
      <td>10962.687002</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-01-05</td>
      <td>5787.839000</td>
      <td>8583.055000</td>
      <td>7276.80000</td>
      <td>13315.896000</td>
    </tr>
  </tbody>
</table>
</div>

[문2] 매장1에 대해서, 일별, 카테고리별 판매량 합계를 구해 봅시다. 

```python
display(sales1.head())
display(products.head())
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order_ID</th>
      <th>Date</th>
      <th>Store_ID</th>
      <th>Qty</th>
      <th>Product_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Product_ID</th>
      <th>Product_Code</th>
      <th>SubCategory</th>
      <th>Category</th>
      <th>LeadTime</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20</td>
      <td>HG001</td>
      <td>Gardening Tools</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>27</td>
      <td>HH001</td>
      <td>Home Appliances</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>150</td>
    </tr>
    <tr>
      <th>2</th>
      <td>16</td>
      <td>HK001</td>
      <td>Kitchen</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>23</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>HK002</td>
      <td>Kitchen</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>41</td>
    </tr>
    <tr>
      <th>4</th>
      <td>32</td>
      <td>GS001</td>
      <td>Seafood</td>
      <td>Grocery</td>
      <td>3</td>
      <td>34</td>
    </tr>
  </tbody>
</table>
</div>

```python
# merge
temp = pd.merge(sales1, products, on='Product_ID', how='inner')
# display(temp)

# groupby
sales_by_date_category = temp.groupby(['Date', 'Category'], as_index=False)['Qty'].sum()
display(sales_by_date_category)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Category</th>
      <th>Qty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-01-01</td>
      <td>Drink</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-01-01</td>
      <td>Food</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-01-01</td>
      <td>Grocery</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-01-01</td>
      <td>Household Goods</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-01-02</td>
      <td>Drink</td>
      <td>1158.000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>119</th>
      <td>2013-01-30</td>
      <td>Household Goods</td>
      <td>932.000</td>
    </tr>
    <tr>
      <th>120</th>
      <td>2013-01-31</td>
      <td>Drink</td>
      <td>971.000</td>
    </tr>
    <tr>
      <th>121</th>
      <td>2013-01-31</td>
      <td>Food</td>
      <td>751.766</td>
    </tr>
    <tr>
      <th>122</th>
      <td>2013-01-31</td>
      <td>Grocery</td>
      <td>1907.797</td>
    </tr>
    <tr>
      <th>123</th>
      <td>2013-01-31</td>
      <td>Household Goods</td>
      <td>711.000</td>
    </tr>
  </tbody>
</table>
<p>124 rows × 3 columns</p>
</div>

[문3] 도시별, 총판매량 합계를 구하시오.  

```python
display(sales.head())
display(stores.head())
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order_ID</th>
      <th>Date</th>
      <th>Store_ID</th>
      <th>Qty</th>
      <th>Product_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store_ID</th>
      <th>City</th>
      <th>State</th>
      <th>Store_Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Oklahoma City</td>
      <td>Oklahoma</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

```python
# merge
temp = pd.merge(sales, stores, on='Store_ID', how='inner')
# display(temp)

# groupby
sales_by_store = temp.groupby('City', as_index=False)['Qty'].sum().round()
display(sales_by_store)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>Qty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Albany</td>
      <td>111941.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Annapolis</td>
      <td>225528.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Asheville</td>
      <td>66445.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Atlanta</td>
      <td>384590.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bloomington</td>
      <td>131541.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Boston</td>
      <td>113805.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Charlotte</td>
      <td>145405.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Columbus</td>
      <td>187215.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Harrisburg</td>
      <td>142127.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Indianapolis</td>
      <td>148804.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>LA</td>
      <td>100975.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Minneapolis</td>
      <td>285260.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Nashville</td>
      <td>118296.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Oklahoma City</td>
      <td>310207.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Olympia</td>
      <td>120558.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Phoenix</td>
      <td>447508.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Raleigh</td>
      <td>1095650.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Richmond</td>
      <td>218849.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Sacramento</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Saint Paul</td>
      <td>4989027.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Wilmington</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

### **(4) pivot**

![pd_pivot](https://github.com/zacinthepark/TIL/assets/86648892/70813558-4d46-4d2c-9f09-a94aa20cc51d)

* pivot : 결합은 아니지만, 집계 후 데이터프레임 구조를 변형해서 조회하는데 종종 사용 됩니다.
* 단계
    * 1) groupby
    * 2) pivot (index, columns, values)

```python
# 1) 매장1의 일별 카테고리별 판매량을 집계

temp = pd.merge(sales1, products)
display(temp.head())
temp2 = temp.groupby(['Date', 'Category'], as_index = False)['Qty'].sum()
display(temp2.head())
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order_ID</th>
      <th>Date</th>
      <th>Store_ID</th>
      <th>Qty</th>
      <th>Product_ID</th>
      <th>Product_Code</th>
      <th>SubCategory</th>
      <th>Category</th>
      <th>LeadTime</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1785</td>
      <td>2013-01-02</td>
      <td>1</td>
      <td>1091.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3567</td>
      <td>2013-01-03</td>
      <td>1</td>
      <td>919.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5349</td>
      <td>2013-01-04</td>
      <td>1</td>
      <td>953.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7131</td>
      <td>2013-01-05</td>
      <td>1</td>
      <td>1160.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>


<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Category</th>
      <th>Qty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-01-01</td>
      <td>Drink</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-01-01</td>
      <td>Food</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-01-01</td>
      <td>Grocery</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-01-01</td>
      <td>Household Goods</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-01-02</td>
      <td>Drink</td>
      <td>1158.0</td>
    </tr>
  </tbody>
</table>
</div>

```python
# 2) pivot
# temp3 = temp2.pivot('Category', 'Date', 'Qty')
temp3 = temp2.pivot(index='Category', columns='Date', values='Qty')
temp4 = temp2.pivot(index='Date', columns='Category', values='Qty')
display(temp4.head())
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Category</th>
      <th>Drink</th>
      <th>Food</th>
      <th>Grocery</th>
      <th>Household Goods</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.0</td>
      <td>0.000</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>1158.0</td>
      <td>1227.652</td>
      <td>3305.130000</td>
      <td>1070.0</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>985.0</td>
      <td>913.699</td>
      <td>2613.685001</td>
      <td>836.0</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1055.0</td>
      <td>790.366</td>
      <td>2711.079001</td>
      <td>834.0</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>1319.0</td>
      <td>901.057</td>
      <td>2746.782000</td>
      <td>821.0</td>
    </tr>
  </tbody>
</table>
</div>

```python
# sns.heatmap으로 시각화 할 수도 있습니다!

plt.figure(figsize = (20, 6))
sns.heatmap(temp3, cmap='Blues')
plt.show()
```

![heat_1](https://github.com/zacinthepark/TIL/assets/86648892/7e76df35-8733-49ee-b8df-d519734f5b59)

## **4.복습문제**

```python
# 라이브러리 불러오기
import pandas as pd
```

```python
sales = pd.read_csv("https://raw.githubusercontent.com/DA4BAM/dataset/master/ts_sales_simple.csv")
products = pd.read_csv("https://raw.githubusercontent.com/DA4BAM/dataset/master/ts_product_master.csv")
stores = pd.read_csv("https://raw.githubusercontent.com/DA4BAM/dataset/master/ts_store_master.csv")

display(sales.head())
display(products.head())
display(stores.head())
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order_ID</th>
      <th>Date</th>
      <th>Store_ID</th>
      <th>Qty</th>
      <th>Product_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Product_ID</th>
      <th>Product_Code</th>
      <th>SubCategory</th>
      <th>Category</th>
      <th>LeadTime</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20</td>
      <td>HG001</td>
      <td>Gardening Tools</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>27</td>
      <td>HH001</td>
      <td>Home Appliances</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>150</td>
    </tr>
    <tr>
      <th>2</th>
      <td>16</td>
      <td>HK001</td>
      <td>Kitchen</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>23</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>HK002</td>
      <td>Kitchen</td>
      <td>Household Goods</td>
      <td>2</td>
      <td>41</td>
    </tr>
    <tr>
      <th>4</th>
      <td>32</td>
      <td>GS001</td>
      <td>Seafood</td>
      <td>Grocery</td>
      <td>3</td>
      <td>34</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store_ID</th>
      <th>City</th>
      <th>State</th>
      <th>Store_Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Saint Paul</td>
      <td>Minnesota</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Oklahoma City</td>
      <td>Oklahoma</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

1) sales에 금액(Amt) 변수를 추가하시오.

* Amt = Qty * Price

```python
temp = pd.merge(sales, products)
temp['Amt'] = temp['Qty'] * temp['Price']
display(temp.head())
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order_ID</th>
      <th>Date</th>
      <th>Store_ID</th>
      <th>Qty</th>
      <th>Product_ID</th>
      <th>Product_Code</th>
      <th>SubCategory</th>
      <th>Category</th>
      <th>LeadTime</th>
      <th>Price</th>
      <th>Amt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>0.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>36</td>
      <td>2013-01-01</td>
      <td>10</td>
      <td>0.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>69</td>
      <td>2013-01-01</td>
      <td>11</td>
      <td>0.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>102</td>
      <td>2013-01-01</td>
      <td>12</td>
      <td>0.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>135</td>
      <td>2013-01-01</td>
      <td>13</td>
      <td>0.0</td>
      <td>3</td>
      <td>DB001</td>
      <td>Beverage</td>
      <td>Drink</td>
      <td>2</td>
      <td>8</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

2) City별 매출액

```python
temp2 = pd.merge(temp, stores)
temp2.groupby('City', as_index=False)['Amt'].sum().round()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>Amt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Albany</td>
      <td>961892.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Annapolis</td>
      <td>1926923.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Asheville</td>
      <td>569999.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Atlanta</td>
      <td>3374833.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bloomington</td>
      <td>1154652.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Boston</td>
      <td>987941.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Charlotte</td>
      <td>1229219.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Columbus</td>
      <td>1650586.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Harrisburg</td>
      <td>1345873.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Indianapolis</td>
      <td>1256235.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>LA</td>
      <td>874484.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Minneapolis</td>
      <td>2545655.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Nashville</td>
      <td>1019337.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Oklahoma City</td>
      <td>2745415.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Olympia</td>
      <td>1053570.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Phoenix</td>
      <td>4192750.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Raleigh</td>
      <td>9539228.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Richmond</td>
      <td>1866015.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Sacramento</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Saint Paul</td>
      <td>44793371.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Wilmington</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

3) City별 카테고리별 매출액

```python
temp2.groupby(['City', 'Category'], as_index=False)['Amt'].sum().round()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>Category</th>
      <th>Amt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Albany</td>
      <td>Drink</td>
      <td>236708.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Albany</td>
      <td>Food</td>
      <td>69986.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Albany</td>
      <td>Grocery</td>
      <td>367648.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albany</td>
      <td>Household Goods</td>
      <td>287550.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Annapolis</td>
      <td>Drink</td>
      <td>350720.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>79</th>
      <td>Saint Paul</td>
      <td>Household Goods</td>
      <td>10812240.0</td>
    </tr>
    <tr>
      <th>80</th>
      <td>Wilmington</td>
      <td>Drink</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>81</th>
      <td>Wilmington</td>
      <td>Food</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Wilmington</td>
      <td>Grocery</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Wilmington</td>
      <td>Household Goods</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>84 rows × 3 columns</p>
</div>

4) 매출액이 가장 높은 주(state) top 3

```python
temp3 = temp2.groupby('State', as_index=False)['Amt'].sum()
temp3.sort_values('Amt', ascending=False).head(3)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>Amt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6</th>
      <td>Minnesota</td>
      <td>4.733903e+07</td>
    </tr>
    <tr>
      <th>8</th>
      <td>North Carolina</td>
      <td>1.133845e+07</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Arizona</td>
      <td>4.192750e+06</td>
    </tr>
  </tbody>
</table>
</div>

> 추가문제

* 2013년 1월 세째 주 각 도시별 subCategory별 금액 비교

    1. 2013년 1월 세째 주
        * sales['Date']를 날짜 타입으로 변환
        * week 추가
        * sales에서 week가 3인 데이터 뽑기

    2. 각 도시별 subCategory별
        * 1의 결과에서...
        * stores와 inner merge
        * products와 inner merge

    3. 도시별 subCategory별 금액
        * Qty * Price로 Amt 추가
        * groupby

    4. 좀더 보기 좋게! pivot + heatmap
        * pivot
        * heatmap

```python
# 1
sales['Date'] = pd.to_datetime(sales['Date'])
sales['Week'] = sales['Date'].dt.isocalendar().week
sales_week3 = sales.loc[sales['Week'] == 3]
sales_week3.head()

# 2
temp = pd.merge(sales_week3, stores)
temp2 = pd.merge(temp, products)
temp2['Amt'] = temp2['Qty'] * temp2['Price']
# temp2.head()

# 3
temp3 = temp2.groupby(['City', 'SubCategory'], as_index=False)['Amt'].sum()
# temp3.head()

# 4
temp4 = temp3.pivot(index='City', columns='SubCategory', values='Amt')
display(temp4)

plt.figure(figsize=(10, 5))
sns.heatmap(temp4)
plt.show()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>SubCategory</th>
      <th>Agricultural products</th>
      <th>Alcohol</th>
      <th>BAKERY</th>
      <th>Beverage</th>
      <th>Cleaning</th>
      <th>EGGS</th>
      <th>Frozen</th>
      <th>Gardening Tools</th>
      <th>Home Appliances</th>
      <th>Kitchen</th>
      <th>Meats</th>
      <th>Milk</th>
      <th>Prepared</th>
      <th>Seafood</th>
    </tr>
    <tr>
      <th>City</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Albany</th>
      <td>67224.0</td>
      <td>6336.0</td>
      <td>7530.00000</td>
      <td>45360.0</td>
      <td>61365.0</td>
      <td>1790.0</td>
      <td>2066.453000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.328659e+04</td>
      <td>1644.0</td>
      <td>4608.000000</td>
      <td>68.000000</td>
    </tr>
    <tr>
      <th>Annapolis</th>
      <td>134160.0</td>
      <td>3672.0</td>
      <td>17250.00000</td>
      <td>86632.0</td>
      <td>126525.0</td>
      <td>2045.0</td>
      <td>4537.717000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.601402e+04</td>
      <td>6044.0</td>
      <td>4878.000000</td>
      <td>1326.000000</td>
    </tr>
    <tr>
      <th>Asheville</th>
      <td>45108.0</td>
      <td>4848.0</td>
      <td>4098.00000</td>
      <td>24192.0</td>
      <td>40245.0</td>
      <td>1160.0</td>
      <td>1421.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.177250e+04</td>
      <td>1896.0</td>
      <td>1854.000000</td>
      <td>136.000000</td>
    </tr>
    <tr>
      <th>Atlanta</th>
      <td>229254.0</td>
      <td>10200.0</td>
      <td>49734.27618</td>
      <td>98968.0</td>
      <td>215130.0</td>
      <td>8795.0</td>
      <td>36590.779290</td>
      <td>2350.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.670804e+04</td>
      <td>19572.0</td>
      <td>27645.804270</td>
      <td>6039.488017</td>
    </tr>
    <tr>
      <th>Bloomington</th>
      <td>90810.0</td>
      <td>2868.0</td>
      <td>9234.00000</td>
      <td>28768.0</td>
      <td>90750.0</td>
      <td>3325.0</td>
      <td>4971.063971</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.398624e+04</td>
      <td>3772.0</td>
      <td>3906.000000</td>
      <td>578.000000</td>
    </tr>
    <tr>
      <th>Boston</th>
      <td>68148.0</td>
      <td>2220.0</td>
      <td>7842.00000</td>
      <td>47720.0</td>
      <td>68655.0</td>
      <td>1115.0</td>
      <td>2834.807971</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.520538e+04</td>
      <td>1780.0</td>
      <td>3402.000000</td>
      <td>1700.000000</td>
    </tr>
    <tr>
      <th>Charlotte</th>
      <td>81708.0</td>
      <td>6252.0</td>
      <td>17148.71418</td>
      <td>53464.0</td>
      <td>64050.0</td>
      <td>6405.0</td>
      <td>10270.466000</td>
      <td>1000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.202440e+04</td>
      <td>10428.0</td>
      <td>11037.006144</td>
      <td>5877.070000</td>
    </tr>
    <tr>
      <th>Columbus</th>
      <td>118752.0</td>
      <td>5364.0</td>
      <td>20010.03000</td>
      <td>41656.0</td>
      <td>98655.0</td>
      <td>4220.0</td>
      <td>24646.810000</td>
      <td>900.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.189503e+04</td>
      <td>12840.0</td>
      <td>23483.699460</td>
      <td>5622.784000</td>
    </tr>
    <tr>
      <th>Harrisburg</th>
      <td>88944.0</td>
      <td>1068.0</td>
      <td>9972.00000</td>
      <td>25056.0</td>
      <td>103230.0</td>
      <td>1105.0</td>
      <td>3625.928000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.127511e+04</td>
      <td>3532.0</td>
      <td>4626.000000</td>
      <td>1802.000000</td>
    </tr>
    <tr>
      <th>Indianapolis</th>
      <td>107418.0</td>
      <td>1704.0</td>
      <td>15900.00000</td>
      <td>34848.0</td>
      <td>95040.0</td>
      <td>2380.0</td>
      <td>1669.791000</td>
      <td>150.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.399642e+04</td>
      <td>5676.0</td>
      <td>6066.000000</td>
      <td>1258.000000</td>
    </tr>
    <tr>
      <th>LA</th>
      <td>74976.0</td>
      <td>2928.0</td>
      <td>7584.00000</td>
      <td>18656.0</td>
      <td>79695.0</td>
      <td>1100.0</td>
      <td>928.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>6.278984e+03</td>
      <td>1008.0</td>
      <td>5076.000000</td>
      <td>442.000000</td>
    </tr>
    <tr>
      <th>Minneapolis</th>
      <td>154536.0</td>
      <td>2760.0</td>
      <td>21186.00000</td>
      <td>119272.0</td>
      <td>157725.0</td>
      <td>2115.0</td>
      <td>4836.359000</td>
      <td>500.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.233291e+04</td>
      <td>4552.0</td>
      <td>2502.000000</td>
      <td>1428.000000</td>
    </tr>
    <tr>
      <th>Nashville</th>
      <td>79128.0</td>
      <td>1956.0</td>
      <td>6996.00000</td>
      <td>31480.0</td>
      <td>78045.0</td>
      <td>1370.0</td>
      <td>3223.785000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.339161e+04</td>
      <td>3180.0</td>
      <td>2808.000000</td>
      <td>1462.000000</td>
    </tr>
    <tr>
      <th>Oklahoma City</th>
      <td>207342.0</td>
      <td>6828.0</td>
      <td>24076.29000</td>
      <td>64512.0</td>
      <td>203970.0</td>
      <td>8390.0</td>
      <td>21226.231000</td>
      <td>700.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.022137e+04</td>
      <td>11388.0</td>
      <td>15984.000000</td>
      <td>3953.112000</td>
    </tr>
    <tr>
      <th>Olympia</th>
      <td>54828.0</td>
      <td>9228.0</td>
      <td>9668.99412</td>
      <td>61608.0</td>
      <td>47850.0</td>
      <td>3170.0</td>
      <td>7185.272000</td>
      <td>1400.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.524745e+04</td>
      <td>7460.0</td>
      <td>9363.708000</td>
      <td>1224.000000</td>
    </tr>
    <tr>
      <th>Phoenix</th>
      <td>268398.0</td>
      <td>10476.0</td>
      <td>28739.11800</td>
      <td>118592.0</td>
      <td>217200.0</td>
      <td>5765.0</td>
      <td>33027.955000</td>
      <td>300.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.571530e+05</td>
      <td>21060.0</td>
      <td>26489.520000</td>
      <td>8589.794000</td>
    </tr>
    <tr>
      <th>Raleigh</th>
      <td>664980.0</td>
      <td>44112.0</td>
      <td>116199.74400</td>
      <td>363656.0</td>
      <td>574995.0</td>
      <td>29835.0</td>
      <td>69453.869029</td>
      <td>4250.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.373565e+05</td>
      <td>61436.0</td>
      <td>63747.827856</td>
      <td>35557.676000</td>
    </tr>
    <tr>
      <th>Richmond</th>
      <td>145746.0</td>
      <td>4404.0</td>
      <td>17779.84200</td>
      <td>59416.0</td>
      <td>131010.0</td>
      <td>5730.0</td>
      <td>17064.440913</td>
      <td>550.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.039810e+04</td>
      <td>10336.0</td>
      <td>10390.410000</td>
      <td>1632.000000</td>
    </tr>
    <tr>
      <th>Sacramento</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Saint Paul</th>
      <td>2761452.0</td>
      <td>128628.0</td>
      <td>383829.01797</td>
      <td>1865480.0</td>
      <td>2379060.0</td>
      <td>145155.0</td>
      <td>523479.115594</td>
      <td>37100.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.230421e+06</td>
      <td>302864.0</td>
      <td>358591.123008</td>
      <td>211315.847898</td>
    </tr>
    <tr>
      <th>Wilmington</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

![heat_2](https://github.com/zacinthepark/TIL/assets/86648892/41b07a02-05e2-425e-8910-77e165c0af63)

## 요약

- 두 개의 데이터프레임 합치기
    - concat
        - 인덱스, 컬럼 이름 기준
        - 데이터프레임 구조에 맞게 합치기
    - merge
        - 특정 열의 값 기준
        - 데이터 값 기준으로 합치기
- pivot
    - 먼저 groupby로 집계하고
    - pivot(index, columns, values)
