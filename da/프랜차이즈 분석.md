# 소상공인시장진흥공단 상가업소정보로 프랜차이즈 입점분석

* 배스킨라빈스와 던킨도너츠는 근처에 입지한 것을 종종 볼 수 있었어요.
* 또, 파리바게뜨와 뚜레주르는 주변에서 많이 볼 수 있는 프랜차이즈 중 하나에요. 
* 이런 프랜차이즈 매장이 얼마나 모여 있는지 혹은 흩어져 있는지 지도에 직접 표시를 해보면서 대용량 데이터에서 원하는 특정 데이터를 추출해 보는 실습을 해봅니다.
* 추출한 데이터를 전처리하고 가공해서 원하는 형태로 시각화를 하거나 지도에 표현합니다.
* Python, Pandas, Numpy, Seaborn, Matplotlib, folium 을 통해 다양한 방법으로 표현하면서 파이썬의 여러 도구들에 익숙해 지는 것을 목표로 합니다.

### 다루는 내용

* 데이터 요약하기
* 공공데이터를 활용해 텍스트 데이터 정제하고 원하는 정보 찾아내기
* 문자열에서 원하는 텍스트 추출하기
* 문자열을 활용한 다양한 분석 방법과 위치 정보 사용하기
* folium을 통한 위경도 데이터 시각화 이해하기
* folium을 통해 지도에 분석한 내용을 표현하기 - CircleMarker와 MarkerCluster 그리기

### 데이터셋

* 공공데이터 포털 : https://www.data.go.kr/dataset/15012005/fileData.do
* 영상에 사용한 데이터셋 : http://bit.ly/open-data-set-folder (공공데이터포털에서 다운로드 받은 파일이 있습니다. 어떤 파일을 다운로드 받아야 될지 모르겠다면 여기에 있는 파일을 사용해 주세요.)

## 필요한 라이브러리 불러오기

```python
# pandas, numpy, seaborn을 불러옵니다.

import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

# 구버전의 주피터 노트북에서 그래프가 보이는 설정
%matplotlib inline
```

## 시각화를 위한 한글 폰트 설정하기

```python
# 폰트 설정이 잘 안 된다면 해당 셀의 마지막 줄 주석을 풀고 실행해 보세요.
# colab 사용시에도 아래 함수를 활용해 보세요.
def get_font_family():
    """
    시스템 환경에 따른 기본 폰트명을 반환하는 함수
    """
    import platform
    system_name = platform.system()

    if system_name == "Darwin" :
        font_family = "AppleGothic"
    elif system_name == "Windows":
        font_family = "Malgun Gothic"
    else:
        # Linux(colab)
        !apt-get install fonts-nanum -qq  > /dev/null
        !fc-cache -fv

        import matplotlib as mpl
        mpl.font_manager._rebuild()
        findfont = mpl.font_manager.fontManager.findfont
        mpl.font_manager.findfont = findfont
        mpl.backends.backend_agg.findfont = findfont
        
        font_family = "NanumBarunGothic"
    return font_family

# plt.rc("font", family=get_font_family())
```

```python
# Win
# plt.rc("font", family="Malgun Gothic")
# Mac
plt.rc("font", family="AppleGothic")
plt.rc("axes", unicode_minus=False)
```

```python
# 한글폰트와 마이너스 폰트 설정 확인
plt.title("한글폰트 설정")
plt.plot([-4, -6, 1, 2, 0, 3])
```

<img width="858" alt="franchise_eda_1" src="https://github.com/zacinthepark/TIL/assets/86648892/b738012d-ce69-464e-a84c-53ad9e0b851e">

## Google Colab 을 위한 코드

### Colab 에서 실행을 위한 코드

* 아래의 코드는 google colaboratory 에서 실행을 위한 코드로 로컬 아나콘다에서는 주석처리합니다.
* google colaboratory 에서는 주석을 풀고 폰트 설정과 csv 파일을 불러옵니다.

### Colab 용 GoogleAuth 인증 

* 구글 드라이브에 있는 파일을 가져오기 위해 사용합니다.

```python
# # 구글 드라이브에서 csv 파일을 읽어오기 위해 gauth 인증
# !pip install -U -q PyDrive
# from pydrive.auth import GoogleAuth
# from pydrive.drive import GoogleDrive
# from google.colab import auth
# from oauth2client.client import GoogleCredentials

# # PyDrive client 인증
# auth.authenticate_user()
# gauth = GoogleAuth()
# gauth.credentials = GoogleCredentials.get_application_default()
# drive = GoogleDrive(gauth)
```

```python
# # 공유 가능한 링크로 파일 가져오기
# url = 'https://drive.google.com/open?id=1e91PH_KRFxNXUsx8Hi-Q2vPiorCDsOP4'
# id = url.split('=')[1]
# print(id)
# downloaded = drive.CreateFile({'id':id}) 
# # data 폴더에 파일을 관리하며, 폴더가 없다면 만들어서 파일을 관리하도록 한다.
# %mkdir data
# downloaded.GetContentFile('data/상가업소정보_201912_01.csv')  
```

## 데이터 불러오기

* 공공데이터 포털 : https://www.data.go.kr/dataset/15012005/fileData.do
* 공공데이터 포털에서 소상공인시장진흥공단 상가업소정보를 다운로드 받아 사용했습니다
* 영상에 사용한 데이터셋 : http://bit.ly/open-data-set-folder (공공데이터포털에서 다운로드 받은 파일이 있습니다. 어떤 파일을 다운로드 받아야 될지 모르겠다면 여기에 있는 파일을 사용해 주세요.)

```python
# 파일을 불러와 df 라는 변수에 담습니다.

df = pd.read_csv("data/상가업소정보_201912_01.csv", sep='|')
df.head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상가업소번호</th>
      <th>상호명</th>
      <th>지점명</th>
      <th>상권업종대분류코드</th>
      <th>상권업종대분류명</th>
      <th>상권업종중분류코드</th>
      <th>상권업종중분류명</th>
      <th>상권업종소분류코드</th>
      <th>상권업종소분류명</th>
      <th>표준산업분류코드</th>
      <th>...</th>
      <th>건물관리번호</th>
      <th>건물명</th>
      <th>도로명주소</th>
      <th>구우편번호</th>
      <th>신우편번호</th>
      <th>동정보</th>
      <th>층정보</th>
      <th>호정보</th>
      <th>경도</th>
      <th>위도</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19905471</td>
      <td>와라와라호프</td>
      <td>NaN</td>
      <td>Q</td>
      <td>음식</td>
      <td>Q09</td>
      <td>유흥주점</td>
      <td>Q09A01</td>
      <td>호프/맥주</td>
      <td>I56219</td>
      <td>...</td>
      <td>1168010600106040000014378</td>
      <td>대치상가</td>
      <td>서울특별시 강남구 남부순환로 2933</td>
      <td>135280</td>
      <td>6280.0</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>127.061026</td>
      <td>37.493922</td>
    </tr>
    <tr>
      <th>1</th>
      <td>19911397</td>
      <td>커피빈코리아선릉로93길점</td>
      <td>코리아선릉로93길점</td>
      <td>Q</td>
      <td>음식</td>
      <td>Q12</td>
      <td>커피점/카페</td>
      <td>Q12A01</td>
      <td>커피전문점/카페/다방</td>
      <td>I56220</td>
      <td>...</td>
      <td>1168010100106960042022041</td>
      <td>NaN</td>
      <td>서울특별시 강남구 선릉로93길 6</td>
      <td>135080</td>
      <td>6149.0</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>127.047883</td>
      <td>37.505675</td>
    </tr>
    <tr>
      <th>2</th>
      <td>19911801</td>
      <td>프로포즈</td>
      <td>NaN</td>
      <td>Q</td>
      <td>음식</td>
      <td>Q09</td>
      <td>유흥주점</td>
      <td>Q09A01</td>
      <td>호프/맥주</td>
      <td>I56219</td>
      <td>...</td>
      <td>1154510200101620001017748</td>
      <td>NaN</td>
      <td>서울특별시 금천구 가산로 34-6</td>
      <td>153010</td>
      <td>8545.0</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>126.899220</td>
      <td>37.471711</td>
    </tr>
    <tr>
      <th>3</th>
      <td>19912201</td>
      <td>싱싱커피&amp;토스트</td>
      <td>NaN</td>
      <td>Q</td>
      <td>음식</td>
      <td>Q07</td>
      <td>패스트푸드</td>
      <td>Q07A10</td>
      <td>토스트전문</td>
      <td>I56192</td>
      <td>...</td>
      <td>2653010400105780000002037</td>
      <td>산업용품유통상가</td>
      <td>부산광역시 사상구 괘감로 37</td>
      <td>617726</td>
      <td>46977.0</td>
      <td>NaN</td>
      <td>1</td>
      <td>26</td>
      <td>128.980455</td>
      <td>35.159774</td>
    </tr>
    <tr>
      <th>4</th>
      <td>19932756</td>
      <td>가락사우나내스낵</td>
      <td>NaN</td>
      <td>F</td>
      <td>생활서비스</td>
      <td>F09</td>
      <td>대중목욕탕/휴게</td>
      <td>F09A02</td>
      <td>사우나/증기탕/온천</td>
      <td>S96121</td>
      <td>...</td>
      <td>1171010500102560005010490</td>
      <td>NaN</td>
      <td>서울특별시 송파구 가락로 71</td>
      <td>138846</td>
      <td>5690.0</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>127.104071</td>
      <td>37.500249</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 39 columns</p>
</div>

### 데이터 크기 보기

```python
# shape 를 통해 불러온 csv 파일의 크기를 확인합니다.
df.shape
```

<pre>
(573680, 39)
</pre>
### info 보기

```python
# info 를 사용하면 데이터의 전체적인 정보를 볼 수 있습니다.
# 데이터의 사이즈, 타입, 메모리 사용량 등을 볼 수 있습니다.

df.info()
```

<pre>
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 573680 entries, 0 to 573679
Data columns (total 39 columns):
 #   Column     Non-Null Count   Dtype  
---  ------     --------------   -----  
 0   상가업소번호     573680 non-null  int64  
 1   상호명        573679 non-null  object 
 2   지점명        76674 non-null   object 
 3   상권업종대분류코드  573680 non-null  object 
 4   상권업종대분류명   573680 non-null  object 
 5   상권업종중분류코드  573680 non-null  object 
 6   상권업종중분류명   573680 non-null  object 
 7   상권업종소분류코드  573680 non-null  object 
 8   상권업종소분류명   573680 non-null  object 
 9   표준산업분류코드   539290 non-null  object 
 10  표준산업분류명    539290 non-null  object 
 11  시도코드       573680 non-null  int64  
 12  시도명        573680 non-null  object 
 13  시군구코드      573680 non-null  int64  
 14  시군구명       573680 non-null  object 
 15  행정동코드      573680 non-null  int64  
 16  행정동명       573680 non-null  object 
 17  법정동코드      573680 non-null  int64  
 18  법정동명       573680 non-null  object 
 19  지번코드       573680 non-null  int64  
 20  대지구분코드     573680 non-null  int64  
 21  대지구분명      573680 non-null  object 
 22  지번본번지      573680 non-null  int64  
 23  지번부번지      474924 non-null  float64
 24  지번주소       573680 non-null  object 
 25  도로명코드      573680 non-null  int64  
 26  도로명        573680 non-null  object 
 27  건물본번지      573680 non-null  int64  
 28  건물부번지      71988 non-null   float64
 29  건물관리번호     573680 non-null  object 
 30  건물명        265608 non-null  object 
 31  도로명주소      573680 non-null  object 
 32  구우편번호      573680 non-null  int64  
 33  신우편번호      573671 non-null  float64
 34  동정보        50856 non-null   object 
 35  층정보        347127 non-null  object 
 36  호정보        85266 non-null   object 
 37  경도         573680 non-null  float64
 38  위도         573680 non-null  float64
dtypes: float64(5), int64(11), object(23)
memory usage: 170.7+ MB
</pre>

### 결측치 보기

```python
# isnull() 을 사용하면 데이터의 결측치를 볼 수 있습니다.
# 결측치는 True로 값이 있다면 False로 표시되는데 True 는 1과 같기 때문에 
# True 값을 sum()을 사용해서 더하게 되면 합계를 볼 수 있습니다.
# mean()을 사용하면 결측치의 비율을 볼 수 있습니다.
df.isnull().mean().plot.barh(figsize=(7, 9))
```

<img width="853" alt="franchise_eda_2" src="https://github.com/zacinthepark/TIL/assets/86648892/a87dda00-cc6f-47c2-8a15-0256ecba8f92">

### 사용하지 않는 컬럼 제거하기

```python
# drop을 하는 방법도 있지만 사용할 컬럼만 따로 모아서 보는 방법도 있습니다.
# 여기에서는 사용할 컬럼만 따로 모아서 사용합니다.

columns = ['상호명', '상권업종대분류명', '상권업종중분류명', '상권업종소분류명', 
           '시도명', '시군구명', '행정동명', '법정동명', '도로명주소', 
           '경도', '위도']
print(df.shape)
df = df[columns].copy()
df.shape
```

<pre>
(573680, 39)
</pre>
<pre>
(573680, 11)
</pre>

```python
# 제거 후 메모리 사용량 보기
df.info()
```

<pre>
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 573680 entries, 0 to 573679
Data columns (total 11 columns):
 #   Column    Non-Null Count   Dtype  
---  ------    --------------   -----  
 0   상호명       573679 non-null  object 
 1   상권업종대분류명  573680 non-null  object 
 2   상권업종중분류명  573680 non-null  object 
 3   상권업종소분류명  573680 non-null  object 
 4   시도명       573680 non-null  object 
 5   시군구명      573680 non-null  object 
 6   행정동명      573680 non-null  object 
 7   법정동명      573680 non-null  object 
 8   도로명주소     573680 non-null  object 
 9   경도        573680 non-null  float64
 10  위도        573680 non-null  float64
dtypes: float64(2), object(9)
memory usage: 48.1+ MB
</pre>

## 색인으로 서브셋 가져오기

### 서울만 따로 보기

```python
# 시도명이 서울로 시작하는 데이터만 봅니다.
# 또, df_seoul 이라는 변수에 결과를 저장합니다.
# 새로운 변수에 데이터프레임을 할당할 때 copy()를 사용하는 것을 권장합니다.

df_seoul = df[df["시도명"] == "서울특별시"].copy()
print(df_seoul.shape)
df_seoul.head()
```

<pre>
(407376, 11)
</pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>상권업종대분류명</th>
      <th>상권업종중분류명</th>
      <th>상권업종소분류명</th>
      <th>시도명</th>
      <th>시군구명</th>
      <th>행정동명</th>
      <th>법정동명</th>
      <th>도로명주소</th>
      <th>경도</th>
      <th>위도</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>와라와라호프</td>
      <td>음식</td>
      <td>유흥주점</td>
      <td>호프/맥주</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>대치1동</td>
      <td>대치동</td>
      <td>서울특별시 강남구 남부순환로 2933</td>
      <td>127.061026</td>
      <td>37.493922</td>
    </tr>
    <tr>
      <th>1</th>
      <td>커피빈코리아선릉로93길점</td>
      <td>음식</td>
      <td>커피점/카페</td>
      <td>커피전문점/카페/다방</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>역삼1동</td>
      <td>역삼동</td>
      <td>서울특별시 강남구 선릉로93길 6</td>
      <td>127.047883</td>
      <td>37.505675</td>
    </tr>
    <tr>
      <th>2</th>
      <td>프로포즈</td>
      <td>음식</td>
      <td>유흥주점</td>
      <td>호프/맥주</td>
      <td>서울특별시</td>
      <td>금천구</td>
      <td>독산3동</td>
      <td>독산동</td>
      <td>서울특별시 금천구 가산로 34-6</td>
      <td>126.899220</td>
      <td>37.471711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>가락사우나내스낵</td>
      <td>생활서비스</td>
      <td>대중목욕탕/휴게</td>
      <td>사우나/증기탕/온천</td>
      <td>서울특별시</td>
      <td>송파구</td>
      <td>석촌동</td>
      <td>석촌동</td>
      <td>서울특별시 송파구 가락로 71</td>
      <td>127.104071</td>
      <td>37.500249</td>
    </tr>
    <tr>
      <th>5</th>
      <td>초밥왕</td>
      <td>음식</td>
      <td>일식/수산물</td>
      <td>음식점-초밥전문</td>
      <td>서울특별시</td>
      <td>송파구</td>
      <td>잠실6동</td>
      <td>신천동</td>
      <td>서울특별시 송파구 올림픽로 293-19</td>
      <td>127.102490</td>
      <td>37.515149</td>
    </tr>
  </tbody>
</table>
</div>

```python
# unique 를 사용하면 중복을 제거한 시군구명을 가져옵니다. 
# 그리고 shape로 갯수를 출력해 봅니다.

df_seoul["시군구명"].unique()
```

<pre>
array(['강남구', '금천구', '송파구', '광진구', '강서구', '중구', '서초구', '성북구', '구로구',
       '영등포구', '서대문구', '동대문구', '노원구', '동작구', '성동구', '관악구', '강동구', '양천구',
       '종로구', '강북구', '은평구', '중랑구', '도봉구', '마포구', '용산구'], dtype=object)
</pre>

```python
# nunique 를 사용하면 중복을 제거한 시군구명의 갯수를 세어줍니다.

df_seoul["시군구명"].nunique()
```

<pre>
25
</pre>

## 파일로 저장하기

* 전처리한 파일을 저장해 두면 재사용을 할 수 있습니다.
* 재사용을 위해 파일로 저장합니다.

```python
# "seoul_open_store.csv" 라는 이름으로 저장합니다.
df_seoul.to_csv("seoul_open_store.csv", index=False)
```

```python
# 제대로 저장이 되었는지 같은 파일을 불러와서 확인합니다.
pd.read_csv("./data/seoul_open_store.csv").head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>상권업종대분류명</th>
      <th>상권업종중분류명</th>
      <th>상권업종소분류명</th>
      <th>시도명</th>
      <th>시군구명</th>
      <th>행정동명</th>
      <th>법정동명</th>
      <th>도로명주소</th>
      <th>경도</th>
      <th>위도</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>와라와라호프</td>
      <td>음식</td>
      <td>유흥주점</td>
      <td>호프/맥주</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>대치1동</td>
      <td>대치동</td>
      <td>서울특별시 강남구 남부순환로 2933</td>
      <td>127.061026</td>
      <td>37.493922</td>
    </tr>
    <tr>
      <th>1</th>
      <td>커피빈코리아선릉로93길점</td>
      <td>음식</td>
      <td>커피점/카페</td>
      <td>커피전문점/카페/다방</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>역삼1동</td>
      <td>역삼동</td>
      <td>서울특별시 강남구 선릉로93길 6</td>
      <td>127.047883</td>
      <td>37.505675</td>
    </tr>
    <tr>
      <th>2</th>
      <td>프로포즈</td>
      <td>음식</td>
      <td>유흥주점</td>
      <td>호프/맥주</td>
      <td>서울특별시</td>
      <td>금천구</td>
      <td>독산3동</td>
      <td>독산동</td>
      <td>서울특별시 금천구 가산로 34-6</td>
      <td>126.899220</td>
      <td>37.471711</td>
    </tr>
    <tr>
      <th>3</th>
      <td>가락사우나내스낵</td>
      <td>생활서비스</td>
      <td>대중목욕탕/휴게</td>
      <td>사우나/증기탕/온천</td>
      <td>서울특별시</td>
      <td>송파구</td>
      <td>석촌동</td>
      <td>석촌동</td>
      <td>서울특별시 송파구 가락로 71</td>
      <td>127.104071</td>
      <td>37.500249</td>
    </tr>
    <tr>
      <th>4</th>
      <td>초밥왕</td>
      <td>음식</td>
      <td>일식/수산물</td>
      <td>음식점-초밥전문</td>
      <td>서울특별시</td>
      <td>송파구</td>
      <td>잠실6동</td>
      <td>신천동</td>
      <td>서울특별시 송파구 올림픽로 293-19</td>
      <td>127.102490</td>
      <td>37.515149</td>
    </tr>
  </tbody>
</table>
</div>

## 배스킨라빈스, 던킨도너츠 위치 분석

### 특정 상호만 가져오기

* 여기에서는 배스킨라빈스와 던킨도너츠 상호를 가져와서 실습합니다.
* 위에서 pandas의 str.contains를 활용해 봅니다.
* https://pandas.pydata.org/docs/user_guide/text.html#testing-for-strings-that-match-or-contain-a-pattern
* 상호명에서 브랜드명을 추출합니다.
* 대소문자가 섞여 있을 수도 있기 때문에 대소문자를 변환해 줍니다.
* 오타를 방지하기 위해 배스킨라빈스의 영문명은 baskinrobbins, 던킨도너츠는 dunkindonuts 입니다.

```python
# 문자열의 소문자로 변경하는 메소드를 사용합니다.
# "상호명_소문자" 컬럼을 만듭니다.

df_seoul["상호명_소문자"] = df_seoul["상호명"].str.lower()
```

```python
df_seoul["상호명_소문자"].str.extract("((베|배)스킨라빈스|baskinrobbins)")[0].value_counts()
```

<pre>
0
배스킨라빈스           347
베스킨라빈스           117
baskinrobbins      2
Name: count, dtype: int64
</pre>

```python
df_seoul["상호명_소문자"].str.extract("(배스킨라빈스|베스킨라빈스|baskinrobbins)")[0].value_counts().sum()
```

<pre>
466
</pre>

```python
# baskinrobbins 를 "상호명_소문자" 컬럼으로 가져옵니다.
# 띄어쓰기 등의 다를 수 있기 때문에 앞글자 baskin 만 따서 가져오도록 합니다.
# '상호명_소문자'컬럼으로 '배스킨라빈스|baskin' 를 가져와 갯수를 세어봅니다.
# loc[행]
# loc[행, 열]

df_seoul.loc[df_seoul["상호명_소문자"].str.contains("배스킨라빈스|베스킨라빈스|baskinrobbins"), 
             "상호명_소문자"].shape
```

<pre>
(466,)
</pre>

```python
# 상호명에서 던킨도너츠만 가져옵니다.
# 상호명은 소문자로 변경해 준 컬럼을 사용합니다.
# 던킨|dunkin 의 "상호명_소문자"로 갯수를 세어봅니다.

df_seoul.loc[df_seoul["상호명_소문자"].str.contains("던킨|dunkin"), "상호명_소문자"].shape
```

<pre>
(191,)
</pre>

```python
# '상호명_소문자'컬럼으로  '배스킨|베스킨|baskin|던킨|dunkin'를 가져와 df_31 변수에 담습니다.

df_31 = df_seoul[df_seoul["상호명_소문자"].str.contains(
    '배스킨라빈스|베스킨라빈스|baskinrobbins|던킨|dunkin')].copy()
df_31.shape
```

<pre>
(657, 12)
</pre>

```python
# ~은 not을 의미합니다. 베스킨라빈스가 아닌 데이터를 찾을 때 사용하면 좋습니다.
# 아래 코드처럼 결측치를 던킨도너츠로 채워줘도 괜찮습니다.
df_31.loc[df_31["상호명_소문자"].str.contains("배스킨라빈스|베스킨라빈스|baskinrobbins"), 
          "브랜드명"] = "배스킨라빈스"
df_31[["상호명", "브랜드명"]].head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>브랜드명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>76</th>
      <td>배스킨라빈스</td>
      <td>배스킨라빈스</td>
    </tr>
    <tr>
      <th>1167</th>
      <td>던킨도너츠</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>1819</th>
      <td>던킨도너츠테크노마트점</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>2164</th>
      <td>베스킨라빈스</td>
      <td>배스킨라빈스</td>
    </tr>
    <tr>
      <th>2305</th>
      <td>던킨도너츠창동하나로</td>
      <td>nan</td>
    </tr>
  </tbody>
</table>
</div>

```python
# 'df_31에 담긴 상호명','브랜드명'으로 미리보기를 합니다.
df_31.loc[~df_31["상호명_소문자"].str.contains("배스킨라빈스|베스킨라빈스|baskinrobbins"), 
          "브랜드명"] = "던킨도너츠"
df_31["브랜드명"]
```

<pre>
76        배스킨라빈스
1167       던킨도너츠
1819       던킨도너츠
2164      배스킨라빈스
2305       던킨도너츠
           ...  
558894     던킨도너츠
560984     던킨도너츠
561929    배스킨라빈스
561930    배스킨라빈스
569825     던킨도너츠
Name: 브랜드명, Length: 657, dtype: object
</pre>

```python
# 데이터가 제대로 모아졌는지 확인합니다.
# "상권업종대분류명"을  value_counts 를 통해 빈도수를 계산합니다.

df_31["상권업종대분류명"].value_counts()
```

<pre>
상권업종대분류명
음식       655
소매         1
생활서비스      1
Name: count, dtype: int64
</pre>

```python
# "상권업종대분류명"컬럼에서 isin 기능을 사용해서 "소매", "생활서비스" 인 데이터만 가져옵니다.

df_31[df_31["상권업종대분류명"].isin(["소매", "생활서비스"])]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>상권업종대분류명</th>
      <th>상권업종중분류명</th>
      <th>상권업종소분류명</th>
      <th>시도명</th>
      <th>시군구명</th>
      <th>행정동명</th>
      <th>법정동명</th>
      <th>도로명주소</th>
      <th>경도</th>
      <th>위도</th>
      <th>상호명_소문자</th>
      <th>브랜드명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>358699</th>
      <td>배스킨라빈스</td>
      <td>소매</td>
      <td>종합소매점</td>
      <td>할인점</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>압구정동</td>
      <td>신사동</td>
      <td>서울특별시 강남구 압구정로 204</td>
      <td>127.029381</td>
      <td>37.527375</td>
      <td>배스킨라빈스</td>
      <td>배스킨라빈스</td>
    </tr>
    <tr>
      <th>556592</th>
      <td>baskinrobbins</td>
      <td>생활서비스</td>
      <td>광고/인쇄</td>
      <td>인쇄종합</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>역삼1동</td>
      <td>역삼동</td>
      <td>서울특별시 강남구 강남대로 396</td>
      <td>127.028289</td>
      <td>37.498154</td>
      <td>baskinrobbins</td>
      <td>배스킨라빈스</td>
    </tr>
  </tbody>
</table>
</div>

```python
# "상권업종대분류명"에서 "소매", "생활서비스"는 제외합니다.
df_31 = df_31[~df_31["상권업종대분류명"].isin(["소매", "생활서비스"])].copy()
df_31.shape
```

<pre>
(655, 13)
</pre>

### 범주형 값으로 countplot 그리기

```python
# value_counts 로 "브랜드명"의 빈도수를 구합니다.
brand_count = df_31["브랜드명"].value_counts()
brand_count
```

<pre>
브랜드명
배스킨라빈스    464
던킨도너츠     191
Name: count, dtype: int64
</pre>

```python
# normalize=True 로 빈도수의 비율을 구합니다.
df_31["브랜드명"].value_counts(normalize=True)
```

<pre>
브랜드명
배스킨라빈스    0.708397
던킨도너츠     0.291603
Name: proportion, dtype: float64
</pre>

```python
# normalize=True 로 빈도수의 비율을 구합니다.
df_31["브랜드명"].value_counts(normalize=True).plot.barh()
```

<img width="858" alt="franchise_eda_3" src="https://github.com/zacinthepark/TIL/assets/86648892/960d37e9-fcb2-4330-b303-3046334ab3ad">

```python
brand_count.index
```

<pre>
Index(['배스킨라빈스', '던킨도너츠'], dtype='object', name='브랜드명')
</pre>

```python
# countplot 을 그립니다.
g = sns.countplot(data=df_31, x="브랜드명")

for i, val in enumerate(brand_count.index):
    g.text(x=i, y=brand_count[i], s=brand_count[i])
```

<img width="851" alt="franchise_eda_4" src="https://github.com/zacinthepark/TIL/assets/86648892/09b58975-847f-48e2-83eb-49157c7523a4">

```python
# 시군구명으로 빈도수를 세고 브랜드명으로 색상을 다르게 표현하는 countplot 을 그립니다.
plt.figure(figsize=(15, 4))
g = sns.countplot(data=df_31, x="시군구명", hue="브랜드명")
```

<img width="858" alt="franchise_eda_5" src="https://github.com/zacinthepark/TIL/assets/86648892/a2bd6068-db87-4513-b8a8-e48a0572d2b8">

```python
# 위 그래프에도 숫자를 표시하고 싶다면 그룹화된 연산이 필요합니다.
# value_counts는 Series에만 사용이 가능하기 때문에 groupby 나 pivot_table로 구해볼 수 있습니다.
table_city_brand = df_31.pivot_table(index="시군구명", columns="브랜드명", values="상호명", aggfunc="count")
table_city_brand.head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>브랜드명</th>
      <th>던킨도너츠</th>
      <th>배스킨라빈스</th>
    </tr>
    <tr>
      <th>시군구명</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>강남구</th>
      <td>29</td>
      <td>38</td>
    </tr>
    <tr>
      <th>강동구</th>
      <td>3</td>
      <td>15</td>
    </tr>
    <tr>
      <th>강북구</th>
      <td>4</td>
      <td>8</td>
    </tr>
    <tr>
      <th>강서구</th>
      <td>12</td>
      <td>24</td>
    </tr>
    <tr>
      <th>관악구</th>
      <td>5</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
</div>

```python
# 그래프에 숫자를 표시하기 위해서는 하나씩 출력을 해봅니다.
# 데이터프레임을 순회할 수있는 iterrows() 을 사용해 보겠습니다.
# 아래에 출력되는 숫자를 그래프에 표시할 예정입니다.
for i, val in table_city_brand.iterrows():
    dunkin = val["던킨도너츠"]
    baskin = val["배스킨라빈스"]
    print(dunkin, baskin)
```

<pre>
29 38
3 15
4 8
12 24
5 13
9 24
4 17
1 8
14 28
1 12
7 11
6 12
7 18
5 22
14 39
2 11
6 23
8 22
6 18
5 16
10 19
9 28
6 9
14 14
4 15
</pre>

```python
plt.figure(figsize=(15, 4))
# 위에서 만든 피봇테이블과 "시군구명"의 순서과 같게 표시되게 하기 위해 order 값을 지정합니다.
g = sns.countplot(data=df_31, x="시군구명", hue="브랜드명", order=table_city_brand.index)

# 여기에서 i 값은 시군구명이라 숫자로 표현해줄 필요가 있습니다.
# 그래서 순서대로 0번부터 찍어줄 수 있도록 index_no 를 만들어 주고 for문을 순회할 때마다 하나씩 증가시킵니다.
index_no = 0
for i, val in table_city_brand.iterrows():
    dunkin = val["던킨도너츠"]
    baskin = val["배스킨라빈스"]
    g.text(x=index_no, y=dunkin, s=dunkin)
    g.text(x=index_no, y=baskin, s=baskin)
    index_no = index_no + 1
```

<img width="862" alt="franchise_eda_6" src="https://github.com/zacinthepark/TIL/assets/86648892/68e452af-5129-4f70-8ac0-e6ca38d04f89">

### scatterplot 그리기

* https://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html#scatter-plot

```python
# Pandas 의 plot 으로 scatterplot 을 그립니다.
df_31[["위도", "경도"]].plot.scatter(x="경도", y="위도")
```

<img width="856" alt="franchise_eda_7" src="https://github.com/zacinthepark/TIL/assets/86648892/2939f575-ec49-461a-abc1-756274a393db">

```python
# seaborn의 scatterplot 으로 hue에 브랜드명을 지정해서 시각화 합니다.

sns.scatterplot(data=df_31, x="경도", y="위도", hue="브랜드명")
```

<img width="857" alt="franchise_eda_8" src="https://github.com/zacinthepark/TIL/assets/86648892/5bba3a50-2483-4504-a995-032b4b3a8279">

```python
# 위에서 그렸던 그래프를 jointplot 으로 kind="hex" 을 사용해 그려봅니다.

sns.jointplot(data=df_31, x="경도", y="위도", kind="hex")
```

<img width="855" alt="franchise_eda_9" src="https://github.com/zacinthepark/TIL/assets/86648892/6f9c8e8b-ce4f-46de-8611-ed9050e77def">

## Folium 으로 지도 활용하기

* 다음의 프롬프트 창을 열어 conda 명령어로 설치합니다.

<img src="https://i.imgur.com/x7pzfCP.jpg">

* <font color="red">주피터 노트북 상에서 설치가 되지 않으니</font> anaconda prompt 를 열어서 설치해 주세요.
* 윈도우
    * <font color="red">관리자 권한</font>으로 아나콘다를 설치하셨다면 다음의 방법으로 anaconda prompt 를 열어 주세요.
    <img src="https://i.imgur.com/GhoLwsd.png">
* 맥
    * terminal 프로그램을 열어 설치해 주세요. 
* 다음의 문서를 활용해서 지도를 표현합니다.
* https://nbviewer.jupyter.org/github/python-visualization/folium/blob/main/examples/Quickstart.ipynb
* Folium 사용예제 :

http://nbviewer.jupyter.org/github/python-visualization/folium/tree/main/examples/

```python
# 아나콘다에서 folium 을 사용하기 위해서는 별도의 설치가 필요
# https://anaconda.org/conda-forge/folium
# conda install -c conda-forge folium 
# 지도 시각화를 위한 라이브러리
import folium
```

```python
# 지도의 중심을 지정하기 위해 위도와 경도의 평균을 구합니다. 
lat = df_31["위도"].mean()
long = df_31["경도"].mean()
lat, long
```

<pre>
(37.548567678569114, 126.99419527148807)
</pre>

```python
# 샘플을 하나 추출해서 지도에 표시해 봅니다.

m = folium.Map([lat, long])
# 127.039032	37.495593
folium.Marker(
    [37.495593, 127.039032], 
    # popup='<i>던킨도너츠</i>', 
    tooltip="던킨도너츠").add_to(m)
# m.save('index.html')
m
```

<img width="859" alt="franchise_eda_10" src="https://github.com/zacinthepark/TIL/assets/86648892/88cc30d5-083d-4e05-a11d-3acd037cb0e0">

```python
# folium 사용법을 보고 일부 데이터를 출력해 봅니다.

df_31.sample(random_state=31)
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>상권업종대분류명</th>
      <th>상권업종중분류명</th>
      <th>상권업종소분류명</th>
      <th>시도명</th>
      <th>시군구명</th>
      <th>행정동명</th>
      <th>법정동명</th>
      <th>도로명주소</th>
      <th>경도</th>
      <th>위도</th>
      <th>상호명_소문자</th>
      <th>브랜드명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>276889</th>
      <td>던킨도너츠</td>
      <td>음식</td>
      <td>패스트푸드</td>
      <td>도너츠전문</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>역삼1동</td>
      <td>역삼동</td>
      <td>서울특별시 강남구 논현로 341</td>
      <td>127.039032</td>
      <td>37.495593</td>
      <td>던킨도너츠</td>
      <td>던킨도너츠</td>
    </tr>
  </tbody>
</table>
</div>

```python
# html 파일로 저장하기
# tooltip 의 한글이 깨져보인다면 html 파일로 저장해서 보세요.
# m.save('index.html')
```

### 서울의 배스킨라빈스와 던킨도너츠 매장 분포

* 배스킨라빈스와 던킨도너츠 매장을 지도에 표현합니다.

```python
# 데이터프레임의 인덱스만 출력합니다.

df_31.index
```

<pre>
Index([    76,   1167,   1819,   2164,   2305,   2342,   3007,  11060,  13042,
        13925,
       ...
       554896, 555145, 557464, 557822, 558006, 558894, 560984, 561929, 561930,
       569825],
      dtype='int64', length=655)
</pre>

### 기본 마커로 표현하기

```python
# icon=folium.Icon(color=icon_color) 로 아이콘 컬러를 변경합니다.

m = folium.Map([lat, long], zoom_start=12)

for i in df_31.index:
    
    sub_lat = df_31.loc[i, "위도"]
    sub_long = df_31.loc[i, "경도"]
    title = df_31.loc[i, "상호명"] + " - " + df_31.loc[i, "도로명주소"]
    
    icon_color = "blue"
    if df_31.loc[i, "브랜드명"] == "던킨도너츠":
        icon_color = "red"
    
    folium.Marker(
        [sub_lat, sub_long], 
        icon=folium.Icon(color=icon_color),
        # popup=f'<i>{title}</i>', 
        tooltip=title).add_to(m)

# m.save('index.html')
m
```

<img width="864" alt="franchise_eda_11" src="https://github.com/zacinthepark/TIL/assets/86648892/19c4ae99-6449-432a-8df3-ad1902b3dce5">

### MarkerCluster 로 표현하기

* https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/MarkerCluster.ipynb

```python
# icon=folium.Icon(color=icon_color) 로 아이콘 컬러를 변경합니다.
from folium.plugins import MarkerCluster

m = folium.Map([lat, long], zoom_start=12)
marker_cluster = MarkerCluster().add_to(m)

for i in df_31.index:
    
    sub_lat = df_31.loc[i, "위도"]
    sub_long = df_31.loc[i, "경도"]
    title = df_31.loc[i, "상호명"] + " - " + df_31.loc[i, "도로명주소"]
    
    icon_color = "blue"
    if df_31.loc[i, "브랜드명"] == "던킨도너츠":
        icon_color = "red"
    
    folium.Marker(
        [sub_lat, sub_long], 
        icon=folium.Icon(color=icon_color),
        # popup=f'<i>{title}</i>', 
        tooltip=title).add_to(marker_cluster)

# m.save('index.html')
m
```

<img width="862" alt="franchise_eda_12" src="https://github.com/zacinthepark/TIL/assets/86648892/765cf854-5bcd-4e3c-9968-faf877f81802">

## 파리바게뜨와 뚜레주르 분석하기

### 데이터 색인으로 가져오기

```python
df_seoul["상호명"].str.extract("뚜레(주|쥬)르")[0].value_counts()
```

<pre>
0
쥬    257
주      1
Name: count, dtype: int64
</pre>

```python
# str.contains 를 사용해서 뚜레(주|쥬)르|파리(바게|크라상) 으로 상호명을 찾습니다.
# df_bread 라는 데이터프레임에 담습니다.
df_bread = df_seoul[df_seoul["상호명"].str.contains("뚜레(주|쥬)르|파리(바게|크라상)")].copy()
df_bread.shape
```

<pre>
(825, 12)
</pre>

### 가져온 데이터가 맞는지 확인하기

```python
# 잘못 가져온 데이터가 있는지 확인합니다.

df_bread["상권업종대분류명"].value_counts()
```

<pre>
상권업종대분류명
음식       823
학문/교육      2
Name: count, dtype: int64
</pre>

```python
# 제과점과 상관 없을 것 같은 상점을 추출합니다.

df_bread[df_bread["상권업종대분류명"] == "학문/교육"]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>상권업종대분류명</th>
      <th>상권업종중분류명</th>
      <th>상권업종소분류명</th>
      <th>시도명</th>
      <th>시군구명</th>
      <th>행정동명</th>
      <th>법정동명</th>
      <th>도로명주소</th>
      <th>경도</th>
      <th>위도</th>
      <th>상호명_소문자</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>354693</th>
      <td>파리바게뜨교육소</td>
      <td>학문/교육</td>
      <td>학원-자격/국가고시</td>
      <td>학원-제과기술</td>
      <td>서울특별시</td>
      <td>영등포구</td>
      <td>영등포동</td>
      <td>영등포동8가</td>
      <td>서울특별시 영등포구 영중로 159</td>
      <td>126.905405</td>
      <td>37.530553</td>
      <td>파리바게뜨교육소</td>
    </tr>
    <tr>
      <th>406627</th>
      <td>뚜레쥬르</td>
      <td>학문/교육</td>
      <td>학원-자격/국가고시</td>
      <td>학원-제과기술</td>
      <td>서울특별시</td>
      <td>금천구</td>
      <td>가산동</td>
      <td>가산동</td>
      <td>서울특별시 금천구 가산디지털1로 128</td>
      <td>126.883684</td>
      <td>37.477224</td>
      <td>뚜레쥬르</td>
    </tr>
  </tbody>
</table>
</div>

```python
# "상권업종대분류명"이 "학문/교육"이 아닌 것만 가져옵니다.

print(df_bread.shape)
df_bread = df_bread[df_bread["상권업종대분류명"] != "학문/교육"].copy()
print(df_bread.shape)
```

<pre>
(825, 12)
(823, 12)
</pre>

```python
# 상호명의 unique 값을 봅니다.

df_bread["상호명"].unique()
```

<pre>
array(['뚜레쥬르', '파리바게뜨길동사거리점', '파리바게뜨상계제일점', '뚜레쥬르중계브라운', '파리바게뜨-판매옥수점',
       '파리바게뜨당고개점', '파리바게뜨목동오거리점', '뚜레쥬르신당역점', '파리바게뜨', '파리바게뜨서강신수점',
       '파리크라상', '파리바게뜨수유중앙점', '파리바게뜨가락중앙점', '파리바게뜨종로구기',
       '뚜레쥬르왕십리민자역사점왕십리민자역사점', '파리크라상교대역점', '뚜레쥬르도선사거리점', '여의도2호파리크라상',
       '목동파리크라상', '뚜레쥬르개봉역점', '파리바게뜨외대점', '파리크라상파스쿠찌홍', '파리크라상파스쿠찌압',
       'CJ뚜레쥬르', '신목파리바게뜨', '방주산업뚜레쥬르광화문경희궁의', '파리크라상파스쿠찌서', '파리크라상파스쿠찌도',
       '강동경희파리바게뜨', '파리크라상이대점', '파리크라상파스쿠찌압구정역2호', '뚜레쥬르송천센트레빌점',
       '파리크라상잠바주스디큐브', '파리크라상잠바주스대치역', '파리바게트', '상계뚜레쥬르', '뚜레쥬르대림3동점',
       '뚜레쥬르목4동점', '카페약수파리바게트', '파리바게뜨가좌역점', '파리바게뜨영등포구청점', '뚜레쥬르독산지식센터점',
       '파리바게뜨수락리버시티', '파리바게뜨방학중앙점', '파리바게뜨중계2호점', '뚜레쥬르방화역점', '파리바게뜨중앙대점',
       '뚜레쥬르레이크펠리스점', '파리바게뜨장안현대점', '뚜레쥬르우이점', '파리바게뜨성북점', '뚜레쥬르양천푸른점',
       '파리바게뜨마장대로점', '파리바게뜨문정역점', '뚜레쥬르엔시티보라매', '파리바게뜨종로시그니처점',
       '파리바게뜨상계보람점', '파리바게뜨성동세무서점', '파리바게뜨여의경도점', '파리바게뜨구로제일점',
       '뚜레쥬르창동SM마트', '파리바게뜨카페대학로점', '파리바게뜨대림역점', '파리바게뜨월계미성', '파리크라상서래점',
       '파리바게뜨금천한양점', '씨제이푸드빌뚜레주르', '파리바게뜨휘경점', '씨제이푸드빌뚜레쥬르대학',
       '파리크라상키친올림픽공원점', '파리바게뜨역', '파리크라상잠바주스동', '파리크라상강남리나스',
       '파리바게트은평뉴타운', '파리크라상잠바주스삼', '뚜레쥬르빨라쪼CU가산디폴', '파리바게트상도건영',
       '파리크라상르노뜨로', '파리바게뜨망우중앙', '파리바게뜨군자역점', '파리바게뜨당산포스빌',
       '파리크라상파리바게뜨신분당', '파리크라상서초아크로비스', '파리바게뜨난곡점', '파리크라상파리바게뜨카페',
       '파리바게뜨쌍문사거리', '파리크라상파스쿠찌신촌연', '파리바게뜨카페하월곡동일점', '길음역파리바게뜨',
       '파리바게트종암사거리', '파리바게뜨까페', '파리바게뜨구로고대', '파리바게뜨평창점', '파리크라상역삼정',
       '파리크라상더월드바인', '뚜레쥬르월곡래미안점', '씨제이푸드빌뚜레쥬르연대', '카페뚜레쥬르', '파리바게트2011년',
       '파리바게뜨신분당선', '파리바게뜨사러가', '뚜레쥬르우장산역점', '회기역파리바게뜨', '뚜레쥬르명동역점',
       '파리바게뜨동대문구청점', '뚜레쥬르풍납현대점', '파리바게뜨올림픽승리점', '뚜레쥬르구로IT점', '파리바게뜨도봉점',
       '파리바게뜨동교삼거리점', '파리바게뜨카페당산동행복점', '파리바게뜨묵동삼거리점', '뚜레쥬르시흥사거리점',
       '파리바게뜨자양2호점', '파리바게뜨사당신동아점', '파리바게뜨불광역점', '뚜레쥬르상월곡역', '파리바게뜨낙성대역점',
       '뚜레쥬르사당시티점', '뚜레쥬르대림우성점', '파리바게뜨북가좌점', '파리바게뜨강남구청센터점', '파리바게뜨중곡역점',
       '파리바게뜨가재울래미안점', '파리바게뜨종로세무서점', '파리바게뜨충무로점', '파리바게뜨-뚝섬점',
       '파리바게뜨문정카페', '파리바게뜨마곡엠밸리점', '뚜레쥬르쌍문선덕', '파리바게뜨창동역동부점', '파리바게뜨마천점',
       '파리바게뜨염창2호점', '명동역남산파리바게뜨', '파리바게뜨신대림자이', '파리바게뜨정동점', '파리바게트마포',
       '군자사랑파리바게뜨', '파리바게뜨논현동점', '파리바게뜨신길돈보스코점', '뚜레쥬르은평뉴타운', '파리바게뜨망원점',
       '파리바게뜨당산역삼성', '적십자파리바게뜨', '파리바게트합정역', '파리바게뜨창동서부점', '파리바게뜨회기역점',
       '뚜레쥬르성내3동점', '파리바게뜨강일리버파크점', '파리바게뜨상계백병원점', '파리바게뜨번동지점',
       '뚜레쥬르화곡역점', '파리바게뜨마포합정역점', '뚜레쥬르구의점', '파리바게뜨논현경복점', '파리바게뜨월곡두산점',
       '뚜레쥬르공덕역점', '파리바게뜨동답한신점', '뚜레쥬르국립중앙의료원점', '파리바게뜨구산역점', '뚜레쥬르공릉2동점',
       '파리바게뜨개포행복점', '뚜레쥬르영등포역', '파리바게뜨강서하이웨이점', '파리바게뜨도봉1동점',
       '파리바게뜨보라매타운점', '뚜레쥬르건대스타시티점', '파리바게뜨발산중앙점', '파리바게뜨중랑역점',
       '파리바게뜨테헤란로점', '파리바게뜨선릉아이타워점', '파리바게뜨내발산', '파리바게뜨강남을지병원점',
       '파리바게뜨동서울터미널점', '파리바게뜨신당역아크로점', '파리바게뜨방이1동점', '뚜레쥬르구의1동점',
       '파리바게뜨온수남부점', '파리바게뜨강남삼성점', '파리바게뜨연희안산점', '파리바게뜨카페전농삼성점',
       '파리바게뜨2001아울렛중계점', '뚜레쥬르상도래미안점', '파리바게뜨목동8단지점', '파리바게뜨방이점',
       '파리바게뜨번동점', '파리바게뜨청담사거리점', '파리바게뜨강남중앙점', '파리바게뜨관악현대점', '파리바게뜨압구정점',
       '뚜레쥬르용마산역점', '파리바게뜨잠실5단지', '뚜레쥬르서울대병원', '파리바게뜨이화사랑점', '뚜레쥬르구의역점',
       '파리바게뜨이수자이점', '파리바게뜨카페신사점', '파리크라상압구정역점', '파리바게뜨일원밀알',
       '파리바게뜨한강타운점', '파리바게뜨역삼래미안점', '뚜레쥬르화곡옛길점', '뚜레쥬르마포도화점', '파리바게뜨청량리점',
       '파리바게뜨올림픽점', '뚜레쥬르신도림태영점', '뚜레쥬르독립문역', '뚜레쥬르고덕아이파크', '파리바게뜨면목역점',
       '뚜레쥬르삼성힐스테이트점', '파리바게뜨송파레미안점', '파리바게뜨당곡사거리점', '파리바게뜨연희대우점',
       '파리바게뜨연신내', '파리바게뜨사당파스텔시티', '파리바게뜨반포타운', '파리바게뜨신림신원점',
       '파리바게뜨동서신의학점', '파리바게뜨서울대입구역점', '파리바게뜨홍대점', '뚜레쥬르강서구청점', '파리바게뜨행당점',
       '파리바게뜨하계벽산점', '파리바게뜨암사브라운스톤점', '파리바게뜨성수코오롱점', '파리크라상홍대점',
       '파리크라상키친삼성역점', '뚜레쥬르신이문', '뚜레쥬르둔촌대우', '파리바게뜨대치하얏트점', '파리바게뜨삼성카페점',
       '파리바게뜨개봉역점', '파리바게뜨신금호역점', '파리바게뜨대림시장점', '뚜레쥬르배명사거리점', '파리바게뜨학동역점',
       '파리크라상샌드위치서울역', '파리바게뜨수서동성당점', '뚜레쥬르종로구청점', '위례아이파크파리바게뜨',
       '파리크라상강남점', '파리바게뜨성내삼성역', '파리바게트상일', '파리바게뜨금호역점', '뚜레쥬르독립문',
       '파리바게뜨뱅뱅사거리점', '파리바게뜨고덕래미안힐스I점', '파리바게트정릉국민대점2호', '파리바게뜨육사화랑회관점',
       '파리크라상연세세브란스점', '파리바게뜨은평뉴타운2지구점', '뚜레쥬르구로개봉점', '파리바게뜨마곡힐스테이트',
       '파리바게뜨수색역점', '파리바게뜨금천롯데캐슬점', '뚜레쥬르카페안암역점', '뚜레쥬르공덕해링턴점', '파리바게트카페',
       '파리바게뜨압구정현대점', '뚜레쥬르왕십리센트라스점', '파리바게트혜화로타리', '파리바게뜨개봉푸르뫼점',
       '파리바게뜨신풍역점', '파리바게뜨올림픽승리', '파리바게뜨제기동역점', '뚜레쥬르응암오거리',
       '파리바게뜨금천롯데캐슬', '파리바게뜨마포점', '파리바게트은평신사', '파리바게뜨신촌현대', '파리바게뜨신림역점',
       '파리바게뜨종로구청', '국회의사당뚜레쥬르', '파리바게트역촌2호', '뚜레쥬르관악우림', '뚜레쥬르신풍역',
       '파리바게뜨동답한신', '파리바게뜨은평뉴타운', '뚜레쥬르무악재', '뚜레쥬르신길삼거리', '파리바게트곰달래',
       '파리바게트종로3가', '파리바게트역삼스타', '파리바게뜨한강성심병원점', '뚜레쥬르양천판교', '뚜레쥬르구의1동',
       '가락중앙파리바게뜨', '씨제이뚜레쥬르', '은천갈입구파리바게뜨', '씨제이푸드빌뚜레쥬르배명사거리',
       '파리바게뜨천호행복', '파리바게트우면동', '파리바게뜨미아삼거리역', '파리바게뜨청담사거리', '파리바게뜨해피석수',
       '뚜레쥬르카페대치점', '파리바게뜨삼성카페', '파리바게뜨동국대', '파리바게뜨중계두타빌', '파리바게뜨역삼초교',
       '파리바게트14478카페마로니에', '파리바게트갤러리아팰리스', '파리바게뜨은평뉴타운3지구', '파리바게뜨사가정',
       '파리바게뜨상도역', '파리바게뜨당고개', '파리바게뜨상계대림', '파리바게뜨상봉한일', '파리바게트가산디지털',
       '파리바게뜨을지로3가역', '씨제이뚜레쥬르풍납현대', '파리바게트방화', '파리바게트13275상일중앙',
       '파리바게뜨강동경희', '뚜레쥬르강서보건소', '뚜레쥬르양천캐슬', '뚜레쥬르숙대입구', '뚜레쥬르성내3동',
       '파리바게트방화역', '파리바게트삼성화재', '파리바게트사당신동아', '파리바게뜨삼성삼익', '파리바게뜨양재드림',
       '파리바게뜨온수역', '파리바게트서초참누리인셉터', '파리바게뜨창동제일', '파리바게뜨양평비즈타워', '파리바게뜨논현',
       '파리바게뜨카페', '파리바게트도곡렉슬', '파리바게뜨방학선덕', '파리바게트17789위례아이파크',
       '파리바게트선릉아이타워인셉터', '뚜레쥬르신림역점', '파리바게트반포제일'], dtype=object)
</pre>

```python
df_bread[df_bread["상호명"].str.contains('파스쿠찌|잠바주스')]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>상권업종대분류명</th>
      <th>상권업종중분류명</th>
      <th>상권업종소분류명</th>
      <th>시도명</th>
      <th>시군구명</th>
      <th>행정동명</th>
      <th>법정동명</th>
      <th>도로명주소</th>
      <th>경도</th>
      <th>위도</th>
      <th>상호명_소문자</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>150108</th>
      <td>파리크라상파스쿠찌홍</td>
      <td>음식</td>
      <td>커피점/카페</td>
      <td>커피전문점/카페/다방</td>
      <td>서울특별시</td>
      <td>마포구</td>
      <td>서강동</td>
      <td>상수동</td>
      <td>서울특별시 마포구 와우산로 94</td>
      <td>126.924922</td>
      <td>37.552600</td>
      <td>파리크라상파스쿠찌홍</td>
    </tr>
    <tr>
      <th>150916</th>
      <td>파리크라상파스쿠찌압</td>
      <td>음식</td>
      <td>제과제빵떡케익</td>
      <td>제과점</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>압구정동</td>
      <td>신사동</td>
      <td>서울특별시 강남구 논현로 868</td>
      <td>127.028866</td>
      <td>37.526073</td>
      <td>파리크라상파스쿠찌압</td>
    </tr>
    <tr>
      <th>165698</th>
      <td>파리크라상파스쿠찌서</td>
      <td>음식</td>
      <td>커피점/카페</td>
      <td>커피전문점/카페/다방</td>
      <td>서울특별시</td>
      <td>종로구</td>
      <td>이화동</td>
      <td>연건동</td>
      <td>서울특별시 종로구 대학로5가길 23</td>
      <td>127.001032</td>
      <td>37.578832</td>
      <td>파리크라상파스쿠찌서</td>
    </tr>
    <tr>
      <th>166894</th>
      <td>파리크라상파스쿠찌도</td>
      <td>음식</td>
      <td>커피점/카페</td>
      <td>커피전문점/카페/다방</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>삼성1동</td>
      <td>삼성동</td>
      <td>서울특별시 강남구 테헤란로87길 22</td>
      <td>127.059427</td>
      <td>37.509624</td>
      <td>파리크라상파스쿠찌도</td>
    </tr>
    <tr>
      <th>167937</th>
      <td>파리크라상파스쿠찌서</td>
      <td>음식</td>
      <td>커피점/카페</td>
      <td>커피전문점/카페/다방</td>
      <td>서울특별시</td>
      <td>종로구</td>
      <td>이화동</td>
      <td>연건동</td>
      <td>서울특별시 종로구 대학로 101</td>
      <td>126.997184</td>
      <td>37.580448</td>
      <td>파리크라상파스쿠찌서</td>
    </tr>
    <tr>
      <th>173293</th>
      <td>파리크라상파스쿠찌압구정역2호</td>
      <td>음식</td>
      <td>제과제빵떡케익</td>
      <td>제과점</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>신사동</td>
      <td>신사동</td>
      <td>서울특별시 강남구 압구정로 162</td>
      <td>127.027449</td>
      <td>37.526305</td>
      <td>파리크라상파스쿠찌압구정역2호</td>
    </tr>
    <tr>
      <th>173492</th>
      <td>파리크라상잠바주스디큐브</td>
      <td>음식</td>
      <td>커피점/카페</td>
      <td>생과일주스전문점</td>
      <td>서울특별시</td>
      <td>구로구</td>
      <td>신도림동</td>
      <td>신도림동</td>
      <td>서울특별시 구로구 경인로 662</td>
      <td>126.888485</td>
      <td>37.508058</td>
      <td>파리크라상잠바주스디큐브</td>
    </tr>
    <tr>
      <th>173775</th>
      <td>파리크라상잠바주스대치역</td>
      <td>음식</td>
      <td>제과제빵떡케익</td>
      <td>제과점</td>
      <td>서울특별시</td>
      <td>강남구</td>
      <td>대치1동</td>
      <td>대치동</td>
      <td>서울특별시 강남구 남부순환로 2942</td>
      <td>127.062308</td>
      <td>37.493635</td>
      <td>파리크라상잠바주스대치역</td>
    </tr>
    <tr>
      <th>263755</th>
      <td>파리크라상잠바주스동</td>
      <td>음식</td>
      <td>제과제빵떡케익</td>
      <td>제과점</td>
      <td>서울특별시</td>
      <td>용산구</td>
      <td>이촌1동</td>
      <td>이촌동</td>
      <td>서울특별시 용산구 이촌로 245</td>
      <td>126.974348</td>
      <td>37.520170</td>
      <td>파리크라상잠바주스동</td>
    </tr>
    <tr>
      <th>267247</th>
      <td>파리크라상잠바주스삼</td>
      <td>음식</td>
      <td>제과제빵떡케익</td>
      <td>제과점</td>
      <td>서울특별시</td>
      <td>서초구</td>
      <td>서초2동</td>
      <td>서초동</td>
      <td>서울특별시 서초구 서초대로78길 22</td>
      <td>127.027528</td>
      <td>37.495796</td>
      <td>파리크라상잠바주스삼</td>
    </tr>
    <tr>
      <th>279459</th>
      <td>파리크라상파스쿠찌신촌연</td>
      <td>음식</td>
      <td>커피점/카페</td>
      <td>커피전문점/카페/다방</td>
      <td>서울특별시</td>
      <td>서대문구</td>
      <td>신촌동</td>
      <td>창천동</td>
      <td>서울특별시 서대문구 연세로 22</td>
      <td>126.937074</td>
      <td>37.557576</td>
      <td>파리크라상파스쿠찌신촌연</td>
    </tr>
  </tbody>
</table>
</div>

```python
# 상호명이 '파스쿠찌|잠바주스'가 아닌 것만 가져오세요.
print(df_bread.shape)
df_bread = df_bread[~df_bread["상호명"].str.contains('파스쿠찌|잠바주스')].copy()
print(df_bread.shape)
```

<pre>
(823, 12)
(812, 12)
</pre>

```python
# 브랜드명 컬럼을 만듭니다. "파리바게뜨" 에 해당되는 데이터에 대한 값을 채워줍니다.

df_bread.loc[df_bread["상호명"].str.contains("파리바게"), "브랜드명"] = "파리바게뜨"
df_bread.loc[df_bread["상호명"].str.contains("파리크라상"), "브랜드명"] = "파리바게뜨"
df_bread.loc[df_bread["상호명"].str.contains("뚜레"), "브랜드명"] = "뚜레쥬르"
df_bread[["상호명", "브랜드명"]].head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>브랜드명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2935</th>
      <td>뚜레쥬르</td>
      <td>뚜레쥬르</td>
    </tr>
    <tr>
      <th>13843</th>
      <td>뚜레쥬르</td>
      <td>뚜레쥬르</td>
    </tr>
    <tr>
      <th>14031</th>
      <td>파리바게뜨길동사거리점</td>
      <td>파리바게뜨</td>
    </tr>
    <tr>
      <th>14229</th>
      <td>파리바게뜨상계제일점</td>
      <td>파리바게뜨</td>
    </tr>
    <tr>
      <th>14246</th>
      <td>뚜레쥬르중계브라운</td>
      <td>뚜레쥬르</td>
    </tr>
  </tbody>
</table>
</div>



```python
df_bread["브랜드명"].isnull().value_counts()
```

<pre>
브랜드명
False    812
Name: count, dtype: int64
</pre>

```python
df_bread[df_bread["브랜드명"].isnull() == True]
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>상권업종대분류명</th>
      <th>상권업종중분류명</th>
      <th>상권업종소분류명</th>
      <th>시도명</th>
      <th>시군구명</th>
      <th>행정동명</th>
      <th>법정동명</th>
      <th>도로명주소</th>
      <th>경도</th>
      <th>위도</th>
      <th>상호명_소문자</th>
      <th>브랜드명</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>

```python
# 브랜드명 컬럼의 결측치는 "뚜레쥬르" 이기 때문에 fillna 를 사용해서 값을 채웁니다.

df_bread["브랜드명"] = df_bread["브랜드명"].fillna("뚜레쥬르")
df_bread[["상호명", "브랜드명"]].head()
```

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상호명</th>
      <th>브랜드명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2935</th>
      <td>뚜레쥬르</td>
      <td>뚜레쥬르</td>
    </tr>
    <tr>
      <th>13843</th>
      <td>뚜레쥬르</td>
      <td>뚜레쥬르</td>
    </tr>
    <tr>
      <th>14031</th>
      <td>파리바게뜨길동사거리점</td>
      <td>파리바게뜨</td>
    </tr>
    <tr>
      <th>14229</th>
      <td>파리바게뜨상계제일점</td>
      <td>파리바게뜨</td>
    </tr>
    <tr>
      <th>14246</th>
      <td>뚜레쥬르중계브라운</td>
      <td>뚜레쥬르</td>
    </tr>
  </tbody>
</table>
</div>

### 범주형 변수 빈도수 계산하기

```python
# 브랜드명의 빈도수를 봅니다.

df_bread["브랜드명"].value_counts()
```

<pre>
브랜드명
파리바게뜨    555
뚜레쥬르     257
Name: count, dtype: int64
</pre>

```python
df_bread["브랜드명"].value_counts(normalize=True)
```

<pre>
브랜드명
파리바게뜨    0.683498
뚜레쥬르     0.316502
Name: proportion, dtype: float64
</pre>

```python
# countplot 으로 브랜드명을 그려봅니다.

sns.countplot(data=df_bread, x="브랜드명")
```

<img width="855" alt="franchise_eda_13" src="https://github.com/zacinthepark/TIL/assets/86648892/ac443cbc-7ac8-4ddc-9e47-3a1d486b677d">

```python
# 시군구별로 브랜드명의 빈도수 차이를 비교합니다.
plt.figure(figsize=(15, 4))
sns.countplot(data=df_bread, x="시군구명", hue="브랜드명")
```

<img width="859" alt="franchise_eda_14" src="https://github.com/zacinthepark/TIL/assets/86648892/67156b7a-e59b-49f8-81c1-7c92ba4fe451">

```python
# scatterplot 으로 위경도를 표현해 봅니다.
sns.scatterplot(data=df_bread, x="경도", y="위도", hue="브랜드명")
```

<img width="859" alt="franchise_eda_15" src="https://github.com/zacinthepark/TIL/assets/86648892/def3d53b-c441-48c0-82df-1da81e5a43d5">

```python
# jointplot 으로 위경도를 표현해 봅니다.
sns.jointplot(data=df_bread, x="경도", y="위도", kind="hex")
```

<img width="853" alt="franchise_eda_16" src="https://github.com/zacinthepark/TIL/assets/86648892/b87b6fee-1e7f-44ba-bd86-82f7ab2ec609">

## 지도에 표현하기

### Marker 로 위치를 찍어보기

```python
df_bread.index
```

<pre>
Index([  2935,  13843,  14031,  14229,  14246,  14713,  14842,  14889,  14897,
        15019,
       ...
       544366, 544527, 551365, 555475, 556168, 559820, 561538, 561810, 569327,
       569479],
      dtype='int64', length=812)
</pre>

```python
df_bread.loc[2935, "위도"]
```

<pre>
37.6282888149588
</pre>

```python
# for i in df_bread.index:
    # print(i)
```

```python
# icon=folium.Icon(color=icon_color) 로 아이콘 컬러를 변경합니다.
m = folium.Map([lat, long], zoom_start=12)

for i in df_bread.index:
    sub_lat = df_bread.loc[i, "위도"]
    sub_long = df_bread.loc[i, "경도"]
    
    title = df_bread.loc[i, "상호명"] + " - " + df_bread.loc[i, "도로명주소"]
    
    icon_color = "blue"
    if df_bread.loc[i, "브랜드명"] == "뚜레쥬르":
        icon_color = "green"

    folium.CircleMarker(
        [sub_lat,sub_long ], 
        radius=3,
        color=icon_color,
        # popup=f'<i>{title}</i>', 
        tooltip=title).add_to(m)

# m.save('paris-tour.html')
m
```

<img width="860" alt="franchise_eda_17" src="https://github.com/zacinthepark/TIL/assets/86648892/9f3e0351-78e2-42f9-b6e0-684e610574bd">

### MarkerCluster 로 표현하기

```python
m = folium.Map([lat, long], zoom_start=12)

marker_cluster = MarkerCluster().add_to(m)

for i in df_bread.index:
    sub_lat = df_bread.loc[i, "위도"]
    sub_long = df_bread.loc[i, "경도"]
    
    title = df_bread.loc[i, "상호명"] + " - " + df_bread.loc[i, "도로명주소"]
    
    icon_color = "blue"
    if df_bread.loc[i, "브랜드명"] == "뚜레쥬르":
        icon_color = "green"

    folium.CircleMarker(
        [sub_lat,sub_long ], 
        radius=3,
        color=icon_color,
        # popup=f'<i>{title}</i>', 
        tooltip=title).add_to(marker_cluster)

# m.save('paris-tour.html')
m
```

<img width="863" alt="franchise_eda_18" src="https://github.com/zacinthepark/TIL/assets/86648892/b1df3861-6bd4-47f4-bd7c-af02b4dfa411">

### Heatmap 으로 그리기

https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/Heatmap.ipynb

```python
# heatmap 예제 이해하기

data = (
    np.random.normal(size=(100, 3)) *  # 평균이 0이고 표준편차가 1인 정규분포에서 무작위로 샘플링하여 100행 3열의 배열을 생성
    np.array([[1, 1, 1]]) +
    np.array([[48, 5, 1]])
).tolist()  # 넘파이 배열을 파이썬의 기본 리스트 형태로 변환
data[:5]
```

<pre>
[[47.63063437738847, 3.424221145523573, 1.2212775983441402],
 [48.12796298953562, 4.915969342717783, -1.2190020399007295],
 [48.02261233823958, 5.689668735763039, 0.8906339857630712],
 [48.11201046955584, 5.344063656114724, 0.8210752261471082],
 [48.34737569330849, 5.300191992307275, -0.9450943598822372]]
</pre>

```python
# heatmap 예제와 같은 형태로 데이터 2차원 배열 만들기
heat = df_bread[["위도", "경도", "브랜드명"]].copy()
heat["브랜드명"] = heat["브랜드명"].str.strip()
heat["브랜드명"] = heat["브랜드명"].replace("뚜레쥬르", 1).replace("파리바게뜨", 1)  # 가중치
heat = heat.values
# heat
```

```python
heat[:5]
```

<pre>
array([[ 37.62828881, 127.07729473,   1.        ],
       [ 37.49809817, 127.02590362,   1.        ],
       [ 37.53415376, 127.13650069,   1.        ],
       [ 37.66136731, 127.059227  ,   1.        ],
       [ 37.63991755, 127.06424515,   1.        ]])
</pre>

```python
# HeatMap 그리기
from folium.plugins import HeatMap

m = folium.Map([lat, long], zoom_start=12)

for i in df_bread.index:
    sub_lat = df_bread.loc[i, "위도"]
    sub_long = df_bread.loc[i, "경도"]
    
    title = df_bread.loc[i, "상호명"] + " - " + df_bread.loc[i, "도로명주소"]
    
    icon_color = "blue"
    if df_bread.loc[i, "브랜드명"] == "뚜레쥬르":
        icon_color = "green"

    folium.CircleMarker(
        [sub_lat,sub_long ], 
        radius=3,
        color=icon_color,
        # popup=f'<i>{title}</i>', 
        tooltip=title).add_to(m)

HeatMap(heat).add_to(m)

# m.save('Heatmap.html')

m
```

<img width="863" alt="franchise_eda_19" src="https://github.com/zacinthepark/TIL/assets/86648892/bfa3f5d6-f6c0-4306-bea1-4ebfe6ae374a">
